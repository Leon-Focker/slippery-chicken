/* translate samp5 in ~/sc/src/all.lsp to C
 *   written Wed 20-Oct-21 at 9:50 by CLM of 8-May-18
 */

#include <mus-config.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdarg.h>
#include <math.h>
#include <signal.h>
#include <cmus.h>

static sig_atomic_t got_sigint = 0; /* catch C-C if hung */
static void sig_err(int sig) {got_sigint = sig;}

int clm_samp5 (double *clm_double, int datar_len, int *clm_int, int datai_len)
{
  /* The _clm_* variables are temporary values generated by the run macro */
  void (*old_SIGINT)(int);
  mus_long_t _clm_20, I;
  bool _clm_18, _clm_12;
  double _clm_66, _clm_65, _clm_64, _clm_63, _clm_59, _clm_58, _clm_55, _clm_54, _clm_48, _clm_47, _clm_46, _clm_40, _clm_39, _clm_30, _clm_29, _clm_24, _clm_23, _clm_21;
  mus_any *_OUTPUT_ = NULL, *_REVERB_ = NULL, *GENB = NULL, *GENA = NULL, *AMPF = NULL, *SENV = NULL;
  void *all_gens = NULL;
  mus_long_t clm_beg, clm_end;
  
  all_gens = clm_make_genbag();
  clm_beg = clm_to_mus_long_t(clm_int, 1);
  clm_end = clm_to_mus_long_t(clm_int, 3);
  I = clm_int[79];
  #define PRINTING 7
  #define PRINTING_r 1
  #define _clm_9 9
  #define _clm_9_r 2
  #define COUNT 11
  #define COUNT_r 3
  #define _SRATE_ 13
  #define _SRATE__r 4
  #define _clm_13 15
  #define _clm_13_r 5
  if (CLM_ENV_P(17))
    SENV = clm_add_gen_to_genbag(all_gens, 
      mus_make_env(
        (double *)(clm_double + CLM_RLOC(17) + 3), /* breakpoints */
        clm_int[CLM_ILOC(17) + 2], /* num points */
        clm_double[CLM_RLOC(17) + 1], /* scaler */
        clm_double[CLM_RLOC(17) + 2], /* offset */
        clm_double[CLM_RLOC(17)], /* base */
        0.0, /* dur useless here */
        clm_int[CLM_ILOC(17) + 3], /* end */
        NULL)); /* original data -- handled internally */
  #define SRE_VAL 19
  #define SRE_VAL_r 7
  if (CLM_ENV_P(21))
    AMPF = clm_add_gen_to_genbag(all_gens, 
      mus_make_env(
        (double *)(clm_double + CLM_RLOC(21) + 3), /* breakpoints */
        clm_int[CLM_ILOC(21) + 2], /* num points */
        clm_double[CLM_RLOC(21) + 1], /* scaler */
        clm_double[CLM_RLOC(21) + 2], /* offset */
        clm_double[CLM_RLOC(21)], /* base */
        0.0, /* dur useless here */
        clm_int[CLM_ILOC(21) + 3], /* end */
        NULL)); /* original data -- handled internally */
  #define AMP_VAL 23
  #define AMP_VAL_r 9
  #define _clm_25 25
  #define _clm_25_r 10
  #define _clm_26 27
  #define _clm_26_r 11
  #define DO_SRC 29
  #define DO_SRC_r 12
  if (CLM_SRC_P(31))
    {
      if (clm_int[CLM_ILOC(31) + 3])
        {
          mus_any *rd = NULL;
          rd = clm_add_gen_to_genbag(all_gens, 
            mus_make_readin(
              (char *)(clm_int + CLM_ILOC(31) + 7 + 2), /* filename */
                clm_int[CLM_ILOC(31) + 4], /* chan */
                clm_to_mus_long_t(clm_int, CLM_ILOC(31) + 5), /* start */
                1)); /* direction */
          GENA = clm_add_gen_to_genbag(all_gens, 
            clm_make_src(clm_as_needed_input,
              clm_double[CLM_RLOC(31)], /* srate */
              clm_int[CLM_ILOC(31) + 2], /* width */
              (void *)rd));
         }
    }
  if (CLM_READIN_P(31))
    GENA = clm_add_gen_to_genbag(all_gens, 
      mus_make_readin_with_buffer_size(
        (char *)(clm_int + CLM_ILOC(31) + 6 + 2), /* filename */
        clm_int[CLM_ILOC(31) + 4], /* chan */
        clm_to_mus_long_t(clm_int, CLM_ILOC(31) + 1), /* start */
        clm_int[CLM_ILOC(31) + 3], /* direction */
        clm_int[CLM_ILOC(31) + 5]));
  #define SAMPA 33
  #define SAMPA_r 14
  #define _clm_32 35
  #define _clm_32_r 15
  #define STEREO_INPUT 37
  #define STEREO_INPUT_r 16
  #define _clm_35 39
  #define _clm_35_r 17
  #define _clm_36 41
  #define _clm_36_r 18
  if (CLM_SRC_P(43))
    {
      if (clm_int[CLM_ILOC(43) + 3])
        {
          mus_any *rd = NULL;
          rd = clm_add_gen_to_genbag(all_gens, 
            mus_make_readin(
              (char *)(clm_int + CLM_ILOC(43) + 7 + 2), /* filename */
                clm_int[CLM_ILOC(43) + 4], /* chan */
                clm_to_mus_long_t(clm_int, CLM_ILOC(43) + 5), /* start */
                1)); /* direction */
          GENB = clm_add_gen_to_genbag(all_gens, 
            clm_make_src(clm_as_needed_input,
              clm_double[CLM_RLOC(43)], /* srate */
              clm_int[CLM_ILOC(43) + 2], /* width */
              (void *)rd));
         }
    }
  if (CLM_READIN_P(43))
    GENB = clm_add_gen_to_genbag(all_gens, 
      mus_make_readin_with_buffer_size(
        (char *)(clm_int + CLM_ILOC(43) + 6 + 2), /* filename */
        clm_int[CLM_ILOC(43) + 4], /* chan */
        clm_to_mus_long_t(clm_int, CLM_ILOC(43) + 1), /* start */
        clm_int[CLM_ILOC(43) + 3], /* direction */
        clm_int[CLM_ILOC(43) + 5]));
  #define SAMPB 45
  #define SAMPB_r 20
  _REVERB_ = clm_reverb();
  #define REV_AMT 49
  #define REV_AMT_r 22
  #define _clm_49 51
  #define _clm_49_r 23
  #define _clm_56 53
  #define _clm_56_r 24
  #define A_A 55
  #define A_A_r 25
  #define _clm_57 57
  #define _clm_57_r 26
  #define B_A 59
  #define B_A_r 27
  #define OUT1_CHAN 61
  #define OUT1_CHAN_r 28
  _OUTPUT_ = clm_output();
  #define _clm_60 65
  #define _clm_60_r 30
  #define A_B 67
  #define A_B_r 31
  #define _clm_61 69
  #define _clm_61_r 32
  #define B_B 71
  #define B_B_r 33
  #define OUT2_CHAN 73
  #define OUT2_CHAN_r 34
  #define A_SCALER 75
  #define A_SCALER_r 35
  #define B_SCALER 77
  #define B_SCALER_r 36
  if (clm_beg > clm_end) return(1);
  got_sigint = 0; old_SIGINT = clm_signal(SIGINT, sig_err);                     /* trap SIGINT */
  I = clm_beg;                                                                  /* pass counter */

SAMPLE_LOOP_BEGIN:
  if (got_sigint != 0) {clm_int[0] = (int)got_sigint; goto RUN_ALL_DONE;}
  if (I > clm_end) {I = clm_end; goto RUN_ALL_DONE;}
                                                                                /* (progn */
                                                                                /* (if printing */
  if (((clm_int[PRINTING] == 0) && (clm_int[PRINTING + 1] == 0))) goto L_5;
                                                                                /* (progn */
                                                                                /* (if (= count *srate*) */
  _clm_12 = (((clm_int[COUNT] == 2) ? clm_double[COUNT_r] : (double)(clm_int[COUNT + 1])) == ((clm_int[_SRATE_] == 2) ? clm_double[_SRATE__r] : (double)(clm_int[_SRATE_ + 1]))); /* (== COUNT *SRATE*) */
  if ((!_clm_12)) goto L_10;
  clm_int[_clm_9 + 0] = 1;
  clm_int[_clm_9 + 0 + 1] = 1;                                                  /* (setf _clm_9 1) */
  goto L_11;
L_10:
  if (clm_int[COUNT + 0] == 1)
    {clm_int[_clm_13 + 0] = 1;
  clm_int[_clm_13 + 0 + 1] = clm_int[COUNT + 0 + 1] + 1;}
  else {clm_int[_clm_13 + 0] = 2;
  clm_double[_clm_13_r+0] = clm_double[COUNT_r + 0] + 1.0;}
  clm_int[_clm_9 + 0] = clm_int[_clm_13 + 0];
  clm_int[_clm_9 + 0 + 1] = clm_int[_clm_13 + 0 + 1];
  clm_double[_clm_9_r + 0] = clm_double[_clm_13_r + 0];                         /* (setf _clm_9 _clm_13) */
L_11:
  clm_int[COUNT + 0] = clm_int[_clm_9 + 0];
  clm_int[COUNT + 0 + 1] = clm_int[_clm_9 + 0 + 1];
  clm_double[COUNT_r + 0] = clm_double[_clm_9_r + 0];                           /* (setf COUNT _clm_9) */
                                                                                /* (if (= count *srate*) */
  _clm_18 = (((clm_int[COUNT] == 2) ? clm_double[COUNT_r] : (double)(clm_int[COUNT + 1])) == ((clm_int[_SRATE_] == 2) ? clm_double[_SRATE__r] : (double)(clm_int[_SRATE_ + 1]))); /* (== COUNT *SRATE*) */
  if ((!_clm_18)) goto L_16;
  _clm_21 = ((double)I / (double)((((clm_int[_SRATE_] == 2) ? clm_double[_SRATE__r] : (double)(clm_int[_SRATE_ + 1])))));
                                                                                /* (/ I *srate*) */
  _clm_20 = (mus_long_t)floor((double)((_clm_21) + .5));                        /* (round _clm_21) */
  if ( (((_clm_20) - (_clm_21)) == .5) && (((mus_long_t)(_clm_20)) & 1) ) _clm_20 -= 1;;
                                                                                /* (clm-print "~%~d"  _clm_20) */
  mus_error(0, "\n%" PRId64" ",
        (mus_long_t)_clm_20);
  goto L_17;
L_16:
L_17:
  goto L_6;
L_5:
L_6:
  _clm_23 = mus_env(SENV);                                                      /* (env SENV) */
  clm_int[SRE_VAL + 0] = 2;
  clm_double[SRE_VAL_r+0] = _clm_23;                                            /* (setf SRE-VAL _clm_23) */
  _clm_24 = mus_env(AMPF);                                                      /* (env AMPF) */
  clm_int[AMP_VAL + 0] = 2;
  clm_double[AMP_VAL_r+0] = _clm_24;                                            /* (setf AMP-VAL _clm_24) */
                                                                                /* (if do-src */
  if (((clm_int[DO_SRC] == 0) && (clm_int[DO_SRC + 1] == 0))) goto L_27;
  _clm_29 = mus_src(GENA, ((clm_int[SRE_VAL] == 2) ? clm_double[SRE_VAL_r] : (double)(clm_int[SRE_VAL + 1])), NULL);
  clm_int[_clm_26 + 0] = 2;
  clm_double[_clm_26_r+0] = _clm_29;                                            /* (setf _clm_26 _clm_29) */
  goto L_28;
L_27:
  _clm_30 = mus_readin(GENA);
  clm_int[_clm_26 + 0] = 2;
  clm_double[_clm_26_r+0] = _clm_30;                                            /* (setf _clm_26 _clm_30) */
L_28:
                                                                                /* (* amp-val _clm_26) */
  if ((clm_int[AMP_VAL + 0] == 1) && (clm_int[_clm_26 + 0] == 1))
    {clm_int[_clm_25 + 0] = 1;
  clm_int[_clm_25 + 0 + 1] = ((clm_int[AMP_VAL + 0 + 1]) * (clm_int[_clm_26 + 0 + 1]));}
  else {clm_int[_clm_25 + 0] = 2;
  clm_double[_clm_25_r+0] = ((((clm_int[AMP_VAL] == 2) ? clm_double[AMP_VAL_r] : (double)(clm_int[AMP_VAL + 1]))) * (((clm_int[_clm_26] == 2) ? clm_double[_clm_26_r] : (double)(clm_int[_clm_26 + 1]))));}
  clm_int[SAMPA + 0] = clm_int[_clm_25 + 0];
  clm_int[SAMPA + 0 + 1] = clm_int[_clm_25 + 0 + 1];
  clm_double[SAMPA_r + 0] = clm_double[_clm_25_r + 0];                          /* (setf SAMPA _clm_25) */
                                                                                /* (if stereo-input */
  if (((clm_int[STEREO_INPUT] == 0) && (clm_int[STEREO_INPUT + 1] == 0))) goto L_33;
                                                                                /* (if do-src */
  if (((clm_int[DO_SRC] == 0) && (clm_int[DO_SRC + 1] == 0))) goto L_37;
  _clm_39 = mus_src(GENB, ((clm_int[SRE_VAL] == 2) ? clm_double[SRE_VAL_r] : (double)(clm_int[SRE_VAL + 1])), NULL);
  clm_int[_clm_36 + 0] = 2;
  clm_double[_clm_36_r+0] = _clm_39;                                            /* (setf _clm_36 _clm_39) */
  goto L_38;
L_37:
  _clm_40 = mus_readin(GENB);
  clm_int[_clm_36 + 0] = 2;
  clm_double[_clm_36_r+0] = _clm_40;                                            /* (setf _clm_36 _clm_40) */
L_38:
                                                                                /* (* amp-val _clm_36) */
  if ((clm_int[AMP_VAL + 0] == 1) && (clm_int[_clm_36 + 0] == 1))
    {clm_int[_clm_35 + 0] = 1;
  clm_int[_clm_35 + 0 + 1] = ((clm_int[AMP_VAL + 0 + 1]) * (clm_int[_clm_36 + 0 + 1]));}
  else {clm_int[_clm_35 + 0] = 2;
  clm_double[_clm_35_r+0] = ((((clm_int[AMP_VAL] == 2) ? clm_double[AMP_VAL_r] : (double)(clm_int[AMP_VAL + 1]))) * (((clm_int[_clm_36] == 2) ? clm_double[_clm_36_r] : (double)(clm_int[_clm_36 + 1]))));}
  clm_int[_clm_32 + 0] = clm_int[_clm_35 + 0];
  clm_int[_clm_32 + 0 + 1] = clm_int[_clm_35 + 0 + 1];
  clm_double[_clm_32_r + 0] = clm_double[_clm_35_r + 0];                        /* (setf _clm_32 _clm_35) */
  goto L_34;
L_33:
  clm_int[_clm_32 + 0] = 0;
  clm_int[_clm_32 + 0 + 1] = 0;                                                 /* (setf _clm_32 NIL) */
L_34:
  clm_int[SAMPB + 0] = clm_int[_clm_32 + 0];
  clm_int[SAMPB + 0 + 1] = clm_int[_clm_32 + 0 + 1];
  clm_double[SAMPB_r + 0] = clm_double[_clm_32_r + 0];                          /* (setf SAMPB _clm_32) */
                                                                                /* (if *reverb* */
  if ((!_REVERB_)) goto L_43;
                                                                                /* (+ sampa sampb) */
  if ((clm_int[SAMPA + 0] == 1) && (clm_int[SAMPB + 0] == 1))
    {clm_int[_clm_49 + 0] = 1;
  clm_int[_clm_49 + 0 + 1] = ((clm_int[SAMPA + 0 + 1]) + (clm_int[SAMPB + 0 + 1]));}
  else {clm_int[_clm_49 + 0] = 2;
  clm_double[_clm_49_r+0] = ((((clm_int[SAMPA] == 2) ? clm_double[SAMPA_r] : (double)(clm_int[SAMPA + 1]))) + (((clm_int[SAMPB] == 2) ? clm_double[SAMPB_r] : (double)(clm_int[SAMPB + 1]))));}
                                                                                /* (* 0.5 _clm_49) */
  _clm_48 = ((0.5) * (((clm_int[_clm_49] == 2) ? clm_double[_clm_49_r] : (double)(clm_int[_clm_49 + 1]))));
                                                                                /* (* rev-amt _clm_48) */
  _clm_47 = ((((clm_int[REV_AMT] == 2) ? clm_double[REV_AMT_r] : (double)(clm_int[REV_AMT + 1]))) * (_clm_48));
  _clm_46 = mus_out_any(I, _clm_47, 0, _REVERB_);
  goto L_44;
L_43:
L_44:
                                                                                /* (if stereo-input */
  if (((clm_int[STEREO_INPUT] == 0) && (clm_int[STEREO_INPUT + 1] == 0))) goto L_51;
                                                                                /* (progn */
                                                                                /* (* a-a sampa) */
  if ((clm_int[A_A + 0] == 1) && (clm_int[SAMPA + 0] == 1))
    {clm_int[_clm_56 + 0] = 1;
  clm_int[_clm_56 + 0 + 1] = ((clm_int[A_A + 0 + 1]) * (clm_int[SAMPA + 0 + 1]));}
  else {clm_int[_clm_56 + 0] = 2;
  clm_double[_clm_56_r+0] = ((((clm_int[A_A] == 2) ? clm_double[A_A_r] : (double)(clm_int[A_A + 1]))) * (((clm_int[SAMPA] == 2) ? clm_double[SAMPA_r] : (double)(clm_int[SAMPA + 1]))));}
                                                                                /* (* b-a sampb) */
  if ((clm_int[B_A + 0] == 1) && (clm_int[SAMPB + 0] == 1))
    {clm_int[_clm_57 + 0] = 1;
  clm_int[_clm_57 + 0 + 1] = ((clm_int[B_A + 0 + 1]) * (clm_int[SAMPB + 0 + 1]));}
  else {clm_int[_clm_57 + 0] = 2;
  clm_double[_clm_57_r+0] = ((((clm_int[B_A] == 2) ? clm_double[B_A_r] : (double)(clm_int[B_A + 1]))) * (((clm_int[SAMPB] == 2) ? clm_double[SAMPB_r] : (double)(clm_int[SAMPB + 1]))));}
                                                                                /* (+ _clm_56 _clm_57) */
  if ((clm_int[_clm_56 + 0] == 1) && (clm_int[_clm_57 + 0] == 1))
    {_clm_55 = ((clm_int[_clm_56 + 0 + 1]) + (clm_int[_clm_57 + 0 + 1]));}
  else {_clm_55 = ((((clm_int[_clm_56] == 2) ? clm_double[_clm_56_r] : (double)(clm_int[_clm_56 + 1]))) + (((clm_int[_clm_57] == 2) ? clm_double[_clm_57_r] : (double)(clm_int[_clm_57 + 1]))));}
  _clm_54 = mus_out_any(I, _clm_55, clm_int[OUT1_CHAN + 0 + 1], _OUTPUT_);
                                                                                /* (* a-b sampa) */
  if ((clm_int[A_B + 0] == 1) && (clm_int[SAMPA + 0] == 1))
    {clm_int[_clm_60 + 0] = 1;
  clm_int[_clm_60 + 0 + 1] = ((clm_int[A_B + 0 + 1]) * (clm_int[SAMPA + 0 + 1]));}
  else {clm_int[_clm_60 + 0] = 2;
  clm_double[_clm_60_r+0] = ((((clm_int[A_B] == 2) ? clm_double[A_B_r] : (double)(clm_int[A_B + 1]))) * (((clm_int[SAMPA] == 2) ? clm_double[SAMPA_r] : (double)(clm_int[SAMPA + 1]))));}
                                                                                /* (* b-b sampb) */
  if ((clm_int[B_B + 0] == 1) && (clm_int[SAMPB + 0] == 1))
    {clm_int[_clm_61 + 0] = 1;
  clm_int[_clm_61 + 0 + 1] = ((clm_int[B_B + 0 + 1]) * (clm_int[SAMPB + 0 + 1]));}
  else {clm_int[_clm_61 + 0] = 2;
  clm_double[_clm_61_r+0] = ((((clm_int[B_B] == 2) ? clm_double[B_B_r] : (double)(clm_int[B_B + 1]))) * (((clm_int[SAMPB] == 2) ? clm_double[SAMPB_r] : (double)(clm_int[SAMPB + 1]))));}
                                                                                /* (+ _clm_60 _clm_61) */
  if ((clm_int[_clm_60 + 0] == 1) && (clm_int[_clm_61 + 0] == 1))
    {_clm_59 = ((clm_int[_clm_60 + 0 + 1]) + (clm_int[_clm_61 + 0 + 1]));}
  else {_clm_59 = ((((clm_int[_clm_60] == 2) ? clm_double[_clm_60_r] : (double)(clm_int[_clm_60 + 1]))) + (((clm_int[_clm_61] == 2) ? clm_double[_clm_61_r] : (double)(clm_int[_clm_61 + 1]))));}
  _clm_58 = mus_out_any(I, _clm_59, clm_int[OUT2_CHAN + 0 + 1], _OUTPUT_);
  goto L_52;
L_51:
                                                                                /* (progn */
                                                                                /* (* a-scaler sampa) */
  if ((clm_int[A_SCALER + 0] == 1) && (clm_int[SAMPA + 0] == 1))
    {_clm_64 = ((clm_int[A_SCALER + 0 + 1]) * (clm_int[SAMPA + 0 + 1]));}
  else {_clm_64 = ((((clm_int[A_SCALER] == 2) ? clm_double[A_SCALER_r] : (double)(clm_int[A_SCALER + 1]))) * (((clm_int[SAMPA] == 2) ? clm_double[SAMPA_r] : (double)(clm_int[SAMPA + 1]))));}
  _clm_63 = mus_out_any(I, _clm_64, clm_int[OUT1_CHAN + 0 + 1], _OUTPUT_);
                                                                                /* (* b-scaler sampa) */
  if ((clm_int[B_SCALER + 0] == 1) && (clm_int[SAMPA + 0] == 1))
    {_clm_66 = ((clm_int[B_SCALER + 0 + 1]) * (clm_int[SAMPA + 0 + 1]));}
  else {_clm_66 = ((((clm_int[B_SCALER] == 2) ? clm_double[B_SCALER_r] : (double)(clm_int[B_SCALER + 1]))) * (((clm_int[SAMPA] == 2) ? clm_double[SAMPA_r] : (double)(clm_int[SAMPA + 1]))));}
  _clm_65 = mus_out_any(I, _clm_66, clm_int[OUT2_CHAN + 0 + 1], _OUTPUT_);
L_52:
  I++;                                                                          /* increment pass counter and loop */
goto SAMPLE_LOOP_BEGIN;

RUN_ALL_DONE:
  clm_signal(SIGINT,old_SIGINT);
  if (all_gens) clm_free_genbag(all_gens);

  return(1);
}

