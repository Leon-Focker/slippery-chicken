<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>slippery chicken documentation - "tempus perfectum" &mdash;
      Composing with L-Systems</title>  
    <!-- change the following two file paths to be ../ if in a subdirectory -->
    <link href="../sc-stylesheet.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../head-foot.js"></script>
    <script language="javascript" type="text/javascript"
            src="../show-hide.js"></script>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  </head>
  
  <body onload="showHide(window.location.hash.substring(1)+'-div')" >
    <div id="content">
      <!-- files in the doc directory will call header with argument "./" but
           those in subdirectories will need "../" -->
      <script type="text/javascript">header("../");</script>
      <noscript>Your browser does not support JavaScript!</noscript>
      <!-- **************************************************************** -->
      
      <h2>"Tempus Perfectum" &mdash; Composing with L-Systems</h2>   
      
      <h3 id="files"><a href="#files" id="files-div-show"
                        onclick="showHide('files-div');return false;">+</a>
        Associated files</h3>
      <div id="files-div" class="more">
        <ul>
          <li><a href="../examples/tempus-perfectum.lsp">The
              slippery-chicken file from this guide</a></li>
          <li><a href="../media/tempus-perfectum.mid">The MIDI output generated
              by this file</a></li>
          <li><a href="../media/_tempus-perfectum-score.pdf">The PDF score
              produced with this file's LilyPond output </a></li>
          <li><a href="../media/tempus-perfectum.eps">The CMN EPS output
              generated by this file</a></li>
          <li><a href="../media/tempus-perfectum_mix.mp3">An MP3 of the
              piece using instrument samples</a></li>
          <li><a href="../media/tempus-perfectum-1-c1-vocal-sounds-seq1-71-psync.mp3">An
          MP3 of the first computer ("tape") part</a></li>
          <li><a href="../media/tempus-perfectum-1-c2-mouth-pops-clicks-seq1-71-psync.mp3">An
              MP3 of the second computer ("tape") part</a></li>
        </ul>
        <p class="close"><a href="#files" id="files-div-hide" class="hideLink"
                            onclick="showHide('files-div');return
                            false;">close</a></p>
      </div>

      <p class="nb">NB: An exercise relating to the material covered
	in this tutorial can be found on
	the <a href="./exercises.html#lsys">Exercises</a> page.</p>

      <!-- MDE as this example uses loop extensively it might be worth
           mentioning this and referring them to the loop tutorial
           http://www.michael-edwards.org/class/moz/cm/doc/contrib/loop.html
           -->

      <p>This demo piece, <em>Tempus Perfectum</em>, and its accompanying
        tutorial, will explore the use of L-systems to generate material
        for <em>slippery chicken</em> compositions. It also provides a
        concrete example of the use of <em>slippery chicken</em> with Common
        Lisp Music (CLM).</p>

      <p>More detail is available for both of these <em>slippery chicken</em>
        features on the <a href="./l-systems.html">L-systems</a>
        and <a href="./sc-and-clm.html">slippery chicken and CLM</a> pages of
        the manual.</p>

      <h3 id="code"><a href="#code" id="code-div-show"
                       onclick="showHide('code-div');return false;">+</a>
        The code</h3>
      <div id="code-div" class="more">
        <p>The code is first presented on its own here, then explained point by
          point below.</p>
        
        <p class="nb">NB: It is strongly recommended that the user not copy and
          paste code from the web browser into the Lisp listener, as this can
          occasionally lead to errors. The code below can be downloaded in
          complete form under the 
          <a href="#files" onclick="jumpShow('files-div')">Associated files</a>
          section above.</p>
        
        <pre class="source">
(let* ((num-seqs 71)
       (src-width 50)
       (sndfile-dir
        (concatenate 'string
                     cl-user::+slippery-chicken-home-dir+
                     "doc/manual/resources/"))
       (ens '(((ob (oboe :midi-channel 1))
               (cl (b-flat-clarinet :midi-channel 2))
               (bn (bassoon :midi-channel 3))
               (hn (french-horn :midi-channel 4))
               (tp (c-trumpet :midi-channel 5))
               (tb (tenor-trombone :midi-channel 6))
               (pr (piano :midi-channel 7))
               (pl (piano-lh :midi-channel 8))
               (vn (violin :midi-channel 9))
               (va (viola :midi-channel 11))
               (vc (cello :midi-channel 12))
               (c1 (computer :midi-channel 13))
               (c2 (computer :midi-channel 14)))))
       (seqs-rules (loop repeat (length (first ens))
                      with l = '(1 2 3 4 5 6 7 8)
                      for p from 0
                      with po = 1
                      with s = nil
                      do (setf s (list (nth (mod p 8) l)
                                       (nth (mod (+ p po) 8) l)
                                       (nth (mod (+ p (* 2 po)) 8) l)
                                       (nth (mod (+ p (* 3 po)) 8) l)))
                      collect (list (1+ p) s)
                      when (= 8 (first s))
                      do (setf po (1+ po))))
       (seqs (make-l-for-lookup 'l-seqs
                                '((1 ((1)))
                                  (2 ((2)))
                                  (3 ((3)))
                                  (4 ((4)))
                                  (5 ((5)))
                                  (6 ((6)))
                                  (7 ((7)))
                                  (8 ((8))))
                                seqs-rules))
       (rsm-lists 
        (loop for s from 1 to (length (first ens))
           for p in (loop for i in (first ens)
                       collect (first i))
           collect (list p (flatten (do-simple-lookup seqs s num-seqs)))))
       (sp '((1 ((cs2 f2 a2 ds2 c3 cs3 d3 gs3 c4 cs4 fs4 g4 gs4 a4 bf4 b4 d5 ds5
                      e5 f5 fs5 a5)))))
       (harms-list (loop repeat (length (second (first rsm-lists)))
                      collect 1))
       (set-lims-progs
        (loop for pchs in '((gs ds5) (g4 fs5) (cs4 fs5) (c4 fs5) (d3 e5) 
                            (d3 e5) (d3 b4) (cs3 b4) (cs3 ds5) (cs3 ds5) 
                            (d3 b4) (cs3 a4) (cs3 e5) (d3 e5) (d3 a5) (c4 a5) 
                            (c4 e5) (c4 d5) (c4 ds5) (c4 f5) (g4 e5) (f2 ds5) 
                            (c4 e5) (a2 f5) (cs2 e5) (cs2 fs5))
           for n from 1
           collect (list n pchs)))
       (set-lims-low (loop for s in set-lims-progs 
                        collect (first s)
                        collect (first (second s))))
       (set-lims-high (loop for s in set-lims-progs 
                         collect (first s)
                         collect (second (second s))))
       (tempus-perfectum
        (make-slippery-chicken
         '+tempus-perfectum+
         :title "Tempus Perfectum"
         :ensemble ens
         :staff-groupings '(3 3 2 3 2)
         :tempo-map '((1 (q 112)))
         :set-palette sp
         :set-map (list (list 1 harms-list))
         :set-limits-high `((all ,set-lims-high)
                            (ob (0 a5 100 a5))
                            (bn (0 g4 100 g4))
                            (hn (0 c5 100 c5))
                            (tb (0 g4 100 g4))
                            (va (0 ds5 100 ds5))
                            (vc (0 g4 100 g4)))
         :set-limits-low `((all ,set-lims-low)
                           (ob (0 g4 100 g4))
                           (hn (0 c3 100 c3))
                           (tp (0 c4 100 c4))
                           (tb (0 a2 100 a2))
                           (vn (0 d4 100 d4)))
         :rthm-seq-palette '((1 ((((3 4) - e (s) s - +q { 3 (te) - te te - })
                                  ((h.))
                                  ((h.))
                                  ((h.))
                                  ((h.))
                                  ((h.)))
                                 :pitch-seq-palette ((1 3 2 3))
                                 :marks (ppp 1 pp 2 ppp 3 cresc-beg 3 cresc-end
                                             4 )))
                             (2 ((((3 4) (h.))
                                  ((h.))
                                  (- e.. 32 - { 3 - +te te te } - - +s s - (e))
                                  (- s. 32 +e - - s s - (e) (q))
                                  ((s) - s (s) s - (q) - e e -)
                                  ((h.)))
                                 :pitch-seq-palette ((5 7 9 7 6 7 6 9 5 6 3 1
                                                        2))
                                 :marks (mf 1 s 1 2 p 3 mf 7 s 7 8 ppp 9 s 12
                                            13)))
                             (3 ((((3 4) (h.))
                                  ((q) q { 3 (ts) ts (ts) } e )
                                  (- e s s - +q q)
                                  ({ 3 (ts) - ts ts - } (e) { 3 (ts) te } 
                                     { 3 - +te ts - } q) 
                                  (h.)
                                  (+q - +e s - (s) q))
                                 :pitch-seq-palette ((10 5 7 1 3 4 10 14 8 6 7
                                                         6 10 12 7))
                                 :marks (pp 1 cresc-beg 1 cresc-end 2 f 2 p 3
                                            mf 4 dim-beg 4 dim-end 9 pp 9 mf 11
                                            dim-beg 11 dim-end 15 ppp 15
                                            cresc-beg 15 cresc-end 16 f 16 s
                                            17 mf 18 te 18)))
                             (4 ((((3 4) { 5 - fe fs fs fs - } { 3 te tq } 
                                   - +e e -)
                                  ((h.))
                                  (q (q) (e) e)
                                  ((e) e (h)) 
                                  (- s s - (e) - e (s) s - - e e -)
                                  ((e.) s +h))
                                 :pitch-seq-palette ((9 7 8 6 3 1 9 9 8 8 7 8 3
                                                        8 2 1 (9)))
                                 :marks (mf 1 dim-beg 1 s 4 ppp 6 dim-end 6 mf
                                            8 at 8 cresc-beg 8 cresc-end 11 f
                                            11 s 12 p 13 a 15 s 16 at 17 mf
                                            17)))
                             (5 ((((3 4) (e) q. - +s e. -)
                                  (e (e) (s) - e s - +e (e))
                                  (e (e) (e.) s - +e. s -)
                                  (- +s e. - (e.) s (q)) 
                                  (e (e) (h))
                                  (e (e) (h)))
                                 :pitch-seq-palette ((1 2 (5) 1 3 2 3 2 1 1 1 
                                                        (5)))
                                 :marks (fff 1 dim-beg 1 mf 3 dim-end 3 ppp 4
                                             cresc-beg 8 cresc-end 9 cresc-beg 
                                             11 cresc-end 13 f 15)))
                             (6 ((((3 4) (h.))
                                  ((e) e (h))
                                  ((h.))
                                  ((h.)) 
                                  ((h.))
                                  ((q) e (e) (q)))
                                 :pitch-seq-palette ((1 (1)))
                                 :marks (p 1 f 2)))
                             (7 ((((3 4) e (e) { 3 - ts ts ts - } (e) (q))
                                  ((h.))
                                  ((h.))
                                  ((h.)) 
                                  ((e..) 32 - e e - (q))
                                  ((h.)))
                                 :pitch-seq-palette ((2 5 4 3 1 6 7))
                                 :marks (ppp 1)))
                             (8 ((((3 4) (h.))
                                  ((h.))
                                  ((h) (e..) 32)
                                  (e (e) (h)) 
                                  ((h.))
                                  (h (q)))
                                 :pitch-seq-palette ((4 1 (2)))
                                 :marks (ppp 1 ff 3))))
         :rthm-seq-map (list (list 1 rsm-lists))
         :snd-output-dir "/tmp"
         :sndfile-palette `(((vocal-sounds
                              ((voice-womanKP-18 :frequency 1028)
                               (voice-womanKP-20 :frequency 456)
                               (voice-womanKP-21 :frequency 484)
                               (voice-womanKP-22 :frequency 591)
                               (voice-womanKP-23 :frequency 662)
                               (voice-womanKP-26 :frequency 516)
                               (voice-womanKP-29 :frequency 629)))
                             (mouth-pops-clicks
                              ((mouth_pop_2 :frequency 375)
                               (mouth_pop_2a :frequency 798)
                               (mouthnoises2 :frequency 703))))
                            ,(list sndfile-dir)
                            ("wav")))))
  (clm-play tempus-perfectum 1 '(c1) 'vocal-sounds
            :rev-amt 0.07
            :reset-snds-each-rs nil
            :pitch-synchronous t
            :src-width src-width
            :srate 44100
            :header-type clm::mus-aiff
            :data-format clm::mus-bshort
            :sndfile-extension ".aiff")
  (clm-play tempus-perfectum 1 '(c2) 'mouth-pops-clicks
            :rev-amt 0.07
            :reset-snds-each-rs nil
            :pitch-synchronous t
            :src-width src-width
            :srate 44100
            :header-type clm::mus-aiff
            :data-format clm::mus-bshort
            :sndfile-extension ".aiff")
  (setf (staff-name (get-data-data 'pl (ensemble tempus-perfectum))) " ")
  (midi-play tempus-perfectum 
             :midi-file "/tmp/tempus-perfectum.mid"
             :voices '(ob cl bn hn tp tb pr pl vn va vc))
  (cmn-display tempus-perfectum
               :file "/tmp/tempus-perfectum.eps"
               :size 11 
               :players '(ob cl bn hn tp tb pr pl vn va vc)
               :in-c t)
  (write-lp-data-for-all tempus-perfectum
                         :players '(ob cl bn hn tp tb pr pl vn va vc)
                         :in-c t))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;; EOF tempus-perfectum.lsp</pre>
      
        <p class="close"><a href="#code" id="code-div-hide" class="hideLink"
                            onclick="showHide('code-div');return
                            false;">close</a></p>
      </div>

      <h3 id="explained">The code explained</h3>
      <h4 id="concept"><a href="#concept" id="concept-div-show"
                          onclick="showHide('concept-div');return false;">+</a> 
        The concept behind the piece</h4>
      <div id="concept-div" class="more">
        <p><em>Tempus perfectum</em> was a term that designated triple meter in
          the mensural notation systems of the Renaissance. A triple meter
          based on three duple beats (<em>tempus perfectum prolatio minor</em>)
          was the equivalent of today's 3/4 time, and was indicated in the
          score by an empty full circle.<sup><a href="#1">[1]</a></sup> </p>

        <p>This piece is constructed from self-similar patterns of
          eight <code>rthm-seq</code> objects that are all in 3/4 time. The
          specific rhythms and melodic contours of these <code>rthm-seqs</code>
          are loosely based on a 6-bar passage from Luciano
          Berio's <em>Circles</em>. In keeping with the cyclical concept and
          with the source composer, the pitch set used and the sculpting of the
          ensemble's overall tessitura are loosely based on a passage from
          Berio's <em>Ritorno Degli Snovidenia</em>.</p>

        <p>The sound files chosen for the computer part are samples of female
          vocalise and mouth sounds (all from
          the <a href="http://wiki.laptop.org/go/Free_sound_samples#The_Open_Path_Music_Custom_Sample_Library_for_OLPC">Open
          Path Music Collection V5</a> and
          the <a href="http://wiki.laptop.org/go/Free_sound_samples#Selections_from_The_Berklee_College_of_Music_Sampling_Archive_.281999-2007.29">Berklee
          College of Music Sampling Archive V5</a> sample collections at
          the <a href="http://wiki.laptop.org/go/Free_sound_samples">One Laptop
          Per Child (OLPC) Free Sound Samples</a> website), as a further aspect
          of homage to Berio's landmark work.</p>

        <h5>Notes</h5>
        <p class="footnote" id="1">[1] Apel, W (1972). <em>Harvard Dictionary
            of Music</em>, 2nd Edition, 22nd Printing. Entry on <em>Mensural
            Notation</em>, p.520. Cambridge, MA: Harvard University Press </p>

        <p class="close"><a href="#concept" id="concept-div-hide"
                            class="hideLink"
                            onclick="showHide('concept-div');return
                            false;">close</a></p>
      </div>

      <h4 id="opening"><a href="#opening" id="opening-div-show"
                       onclick="showHide('opening-div');return false;">+</a>
        The opening variables</h4>
      <div id="opening-div" class="more">
        <p>As with <a "./nouveau-reich.html"><em>Nouveau Reich</em></a>, the
          code for this composition begins with a number of fundamental
          variables, including <code>num-seqs</code>, <code>src-width</code>,
          and <code>sndfile-dir</code>, which determine the length of the
          piece, the quality of the sound file sample transposition, and the
          directory where the sound files used in the computer part are
          stored. </p>

        <p>The <code>sndfile-dir</code> variable uses Lisp's
          <code>concatenate</code> function together
          with <em>slippery-chicken's</em> built-in global variable for its
          home directory to create the string for the path to
          the <tt>sc/doc/manual/resources/</tt> directory. </p>

        <p>The <code>ensemble</code> is also predefined here and assigned to
          the variable <code>ens</code>. This enables the subsequent loops that
          generate the L-system rules and the <code>rthm-seq-map</code> to be
          based on the number of players in the ensemble and their IDs,
          allowing the user to change the instrumentation and have the rules
          and <code>rthm-seq-map</code> automatically changed accordingly. </p>

        <pre class="source">
(let* ((num-seqs 71)
       (src-width 50)
       (sndfile-dir
        (concatenate 'string
                     cl-user::+slippery-chicken-home-dir+
                     "doc/manual/resources/"))
       (ens '(((ob (oboe :midi-channel 1))
               (cl (b-flat-clarinet :midi-channel 2))
               (bn (bassoon :midi-channel 3))
               (hn (french-horn :midi-channel 4))
               (tp (c-trumpet :midi-channel 5))
               (tb (tenor-trombone :midi-channel 6))
               (pr (piano :midi-channel 7))
               (pl (piano-lh :midi-channel 8))
               (vn (violin :midi-channel 9))
               (va (viola :midi-channel 11))
               (vc (cello :midi-channel 12))
               (c1 (computer :midi-channel 13))
               (c2 (computer :midi-channel 14)))))</pre>

        <p class="close"><a href="#opening" id="opening-div-hide"
                            class="hideLink"
                            onclick="showHide('opening-div');return
                            false;">close</a></p>
      </div>
 
      <h4>Using L-systems to generate the rthm-seq-map</h4>
      <h5 id="elements"><a href="#elements" id="elements-div-show"
                       onclick="showHide('elements-div');return false;">+</a>
        The elements</h5>
      <div id="elements-div" class="more">
        <p>The order in which the <code>rthm-seq</code> objects occur in each
          player's part in <em>Tempus Perfectum</em> is determined using an
          L-system. The piece has eight separate 6-bar <code>rthm-seqs</code>,
          each with a numeric ID, so the list of elements in the call to
          <code>make-l-for-lookup</code> contains references to all 8 of these
          IDs. </p>

        <!-- MDE Tue Aug 21 12:07:06 2012 -- so you're not taking
             advantage of the transitions?  do you do this elsewhere?
             do you mention this fact?  -->
        <pre class="source">
       (seqs (make-l-for-lookup 'l-seqs
                                '((1 ((1)))
                                  (2 ((2)))
                                  (3 ((3)))
                                  (4 ((4)))
                                  (5 ((5)))
                                  (6 ((6)))
                                  (7 ((7)))
                                  (8 ((8))))
                                seqs-rules))</pre>

        <p class="close"><a href="#elements" id="elements-div-hide"
                            class="hideLink"
                            onclick="showHide('elements-div');return
                            false;">close</a></p>
      </div>
        
      <h5 id="rules"><a href="#rules" id="rules-div-show"
                       onclick="showHide('rules-div');return false;">+</a>
        The rules</h5>
      <div id="rules-div" class="more">
        <p>The rules for this <code>l-for-lookup</code> object are defined
          immediately prior to calling <code>make-l-for-lookup</code> and are
          passed to the function through the
          variable <code>seqs-rules</code>. They are constructed using a loop
          to collect a different 4-element set from the numbers <code>1</code>
          to <code>8</code> for each of the players in the piece. Having a
          separate rule for each player ensures that each player will have a
          different sequence of <code>rthm-seqs</code> in the course of the
          piece. </p>

        <!-- MDE Tue Aug 21 12:03:31 2012 -- the problem with the lseq
             was perhaps caused by algo-generating the rules: I've
             never done this because I find fine-tuning the rules
             essential to the piece also: rather than hard-coding 8 do
             you mean the length of list l?  also: why do these rules
             generate entries for 9-13 when the returned values range
             from 1-8--because of the 13 players?  if so, you might
             mention this here or refer to the description below as
             it's a little odd on first sight -->
        <pre class="source">
       (seqs-rules (loop repeat (length (first ens))
                      with l = '(1 2 3 4 5 6 7 8)
                      for p from 0
                      with po = 1
                      with s = nil
                      do (setf s (list (nth (mod p 8) l)
                                       (nth (mod (+ p po) 8) l)
                                       (nth (mod (+ p (* 2 po)) 8) l)
                                       (nth (mod (+ p (* 3 po)) 8) l)))
                      collect (list (1+ p) s)
                      when (= 8 (first s))
                      do (setf po (1+ po))))</pre>

        <p>This loop produces the following rules:</p>

        <pre class="source">
=> 
((1 (1 2 3 4)) (2 (2 3 4 5)) (3 (3 4 5 6)) (4 (4 5 6 7)) (5 (5 6 7 8))
 (6 (6 7 8 1)) (7 (7 8 1 2)) (8 (8 1 2 3)) (9 (1 3 5 7)) (10 (2 4 6 8))
 (11 (3 5 7 1)) (12 (4 6 8 2)) (13 (5 7 1 3)))</pre>

        <p class="close"><a href="#rules" id="rules-div-hide" class="hideLink"
                            onclick="showHide('rules-div');return
                            false;">close</a></p>
      </div>
      

      <h5 id="dsl"><a href="#dsl" id="dsl-div-show"
                       onclick="showHide('dsl-div');return false;">+</a>
        Constructing the rthm-seq-map using do-simple-lookup</h5>
      <div id="dsl-div" class="more">
        <p>The inner portions of the <code>rthm-seq-map</code> are then
          constructed and assigned to the variable <code>rsm-lists</code>. They
          are assembled from the previously created <code>l-for-lookup</code>
          object using a loop that pairs the IDs of the players, as listed in
          the variable <code>ens</code>, with the flattened results of
          the <code>do-simple-lookup</code> method. (See the source code
          documentation for
          the <a href="../robodoc/utilities_lsp.html#utilities2fflatten"><code>flatten</code></a>
          function for more detail.)</p>

        <p>The <code>do-simple-lookup</code> method is called using
          the <code>seqs</code> variable as its first argument to create
          separate lists that are <code>num-seqs</code> long for each of the
          players assigned to <code>p</code>, including the two computer
          parts. It creates these lists by initiating each L-system iteration
          with a different axiom, consisting of consecutive numbers
          from <code>1</code> to the length of the list of players in
          the <code>ens</code> variable (<code>13</code>, one for each
          rule/player).</p>

        <pre class="source">
       (rsm-lists 
        (loop for s from 1 to (length (first ens))
           for p in (loop for i in (first ens)
                       collect (first i))
           collect (list p (flatten (do-simple-lookup seqs s num-seqs)))))</pre>

        <p>This loop ensures that each player's part in
          the <code>rthm-seq-map</code> begins with a differently ordered
          sequence. After this initial difference, all subsequent sequences
          will only be created using rules <code>1</code>
          through <code>8</code>, as these are the only elements used in each
          rule. The combination of the rules and this particular loop produces
          a <code>rthm-seq-map</code> in which all players play
          all <code>rthm-seqs</code> of the <code>rthm-seq-palette</code> at
          least once during the course of the piece.</p>

        <p class="close"><a href="#dsl" id="dsl-div-hide" class="hideLink"
                            onclick="showHide('dsl-div');return
                            false;">close</a></p>
      </div>


      <h5 id="sim"><a href="#sim" id="sim-div-show"
                       onclick="showHide('sim-div');return false;">+</a>
        Self-similarity in the results</h5>
      <div id="sim-div" class="more">
        <p>The resulting <code>rthm-seq-map</code> would look like this if
          written out in full, with a few of the repeating sequences
          color-coded to highlight the self-similarity:</p>

        <pre class="source">
((OB
  (<span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> 4 5 6 7 <span class="yellow">2 3 4 5 3 4 5 6 4 5 6 7 5 6 7 8</span> 3 4 5 6
   4 5 6 7 5 6 7 8 6 7 8 1 4 5 6 7 5 6 7 8 6 7 8 1 7 8 1 2 2 3 4 5 3 4 5))
 (CL
  (<span class="yellow">2 3 4 5 3 4 5 6 4 5 6 7 5 6 7 8</span> 3 4 5 6 4 5 6 7 5 6 7 8 6 7 8 1 4 5 6 7
   5 6 7 8 6 7 8 1 7 8 1 2 5 6 7 8 6 7 8 1 7 8 1 2 8 1 2 3 3 4 5 6 4 5 6))
 (BN
  (3 4 5 6 4 5 6 7 5 6 7 8 6 7 8 1 4 5 6 7 5 6 7 8 6 7 8 1 7 8 1 2 5 6 7 8
   6 7 8 1 7 8 1 2 8 1 2 3 6 7 8 1 <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> 4 5 6 7 5 6 7))
 (HN
  (4 5 6 7 5 6 7 8 6 7 8 1 7 8 1 2 5 6 7 8 6 7 8 1 7 8 1 2 8 1 2 3 6 7 8 1
   <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> 2 3 4 5 5 6 7 8 6 7 8))
 (TP
  (5 6 7 8 6 7 8 1 7 8 1 2 8 1 2 3 6 7 8 1 <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> 7 8 1 2
   8 1 2 3 1 2 3 4 2 3 4 5 8 1 2 3 <span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> 6 7 8 1 7 8 1))
 (TB
  (6 7 8 1 <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> 2 3 4 5 8 1 2 3
   <span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> <span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> 4 5 6 7 7 8 1 2 8 1 2))
 (PR
  (<span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> 2 3 4 5 8 1 2 3 <span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> 1 2 3 4
   2 3 4 5 3 4 5 6 4 5 6 7 <span class="yellow">2 3 4 5 3 4 5 6 4 5 6 7 5 6 7 8</span> 8 1 2 3 1 2 3))
 (PL
  (8 1 2 3 <span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> <span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> 4 5 6 7 2 3 4 5
   3 4 5 6 4 5 6 7 5 6 7 8 3 4 5 6 4 5 6 7 5 6 7 8 6 7 8 1 1 2 3 4 2 3 4))
 (VN
  (<span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> 4 5 6 7 <span class="yellow">2 3 4 5 3 4 5 6 4 5 6 7 5 6 7 8</span> 3 4 5 6
   4 5 6 7 5 6 7 8 6 7 8 1 4 5 6 7 5 6 7 8 6 7 8 1 7 8 1 2 3 4 5 6 4 5 6))
 (VA
  (<span class="yellow">2 3 4 5 3 4 5 6 4 5 6 7 5 6 7 8</span> 3 4 5 6 4 5 6 7 5 6 7 8 6 7 8 1 4 5 6 7
   5 6 7 8 6 7 8 1 7 8 1 2 5 6 7 8 6 7 8 1 7 8 1 2 8 1 2 3 4 5 6 7 5 6 7))
 (VC
  (3 4 5 6 4 5 6 7 5 6 7 8 6 7 8 1 4 5 6 7 5 6 7 8 6 7 8 1 7 8 1 2 5 6 7 8
   6 7 8 1 7 8 1 2 8 1 2 3 6 7 8 1 <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> 5 6 7 8 6 7 8))
 (C1
  (4 5 6 7 5 6 7 8 6 7 8 1 7 8 1 2 5 6 7 8 6 7 8 1 7 8 1 2 8 1 2 3 6 7 8 1
   <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> 2 3 4 5 6 7 8 1 7 8 1))
 (C2
  (5 6 7 8 6 7 8 1 7 8 1 2 8 1 2 3 6 7 8 1 <span class="blue">7 8 1 2 8 1 2 3 1 2 3 4</span> 7 8 1 2
   8 1 2 3 1 2 3 4 2 3 4 5 8 1 2 3 <span class="red">1 2 3 4 2 3 4 5 3 4 5 6</span> 7 8 1 2 8 1 2)))</pre>

        <h6>Occasional rhythmic unison in multiple parts</h6>
        <p>As can be seen in the code example above, the use of different
          axioms for each call to <code>do-simple-lookup</code> still produces
          a number of instances where the same sequence segment appears in more
          than one part simultaneously. This will produce a nice effect of
          coupling (non-unison rhythmic doubling) in various passages of the
          instrumental parts. </p>

        <p class="close"><a href="#sim" id="sim-div-hide" class="hideLink"
                            onclick="showHide('sim-div');return
                            false;">close</a></p>
      </div>

      <h4 id="tessitura"><a href="#tessitura" id="tessitura-div-show"
                       onclick="showHide('tessitura-div');return false;">+</a>
        Shaping the ensemble's tessitura</h4>
      <div id="tessitura-div" class="more">
        <h5>One set for the entire piece</h5>
        <p>This piece uses a different approach to controlling the progression
          of pitch collections (sets) over the course of a <em>slippery
          chicken</em> composition than that of the first three demo
          compositions. Instead of defining multiple sets and assigning their
          IDs to individual sequences in the <code>set-map</code>, one set of
          pitches is defined for the entire piece, and the subsets of pitches
          available to the ensemble as the piece progresses are governed using
          the <code>set-limits-high</code> and <code>-low</code> slots in
          conjunction with their <code>all</code> option. </p>

        <p>The set of pitches is given the ID <code>1</code> and assigned to
          the variable <code>sp</code>, and a simple loop is used to collect a
          list of <code>1</code>s that is equal in length to the list
          of <code>rthm-seqs</code> and assigned to the
          variable <code>harms-list</code>. </p>

        <pre class="source">
       (sp '((1 ((cs2 f2 a2 ds2 c3 cs3 d3 gs3 c4 cs4 fs4 g4 gs4 a4 bf4 b4 d5 ds5
                      e5 f5 fs5 a5)))))
       (harms-list (loop repeat (length (second (first rsm-lists)))
                      collect 1))</pre>

        <h5>Collecting the high and low set limits</h5>
        <p>The gradually changing upper and lower pitch limits within this set
           are then determined by first collecting a list of consecutive
           integers from <code>1</code> and pairing them with sublists
           consisting of the lowest and highest pitches available to the
           ensemble at consecutive points within the piece. The results of this
           loop are assigned to the variable <code>set-lims-progs</code>. </p>

        <pre class="source">
       (set-lims-progs
        (loop for pchs in '((g4 ds5) (g4 fs5) (cs4 fs5) (c4 fs5) (d3 e5) 
                            (d3 e5) (d3 b4) (cs3 b4) (cs3 ds5) (cs3 ds5) 
                            (d3 b4) (cs3 a4) (cs3 e5) (d3 e5) (d3 a5) (c4 a5) 
                            (c4 e5) (c4 d5) (c4 ds5) (c4 f5) (g4 e5) (f2 ds5) 
                            (c4 e5) (a2 f5) (cs2 e5) (cs2 fs5))
           for n from 1
           collect (list n pchs)))</pre>

        <p>The <code>set-lims-progs</code> list is then further broken down
          into the <code>-high</code> and <code>-low</code> lists with two more
          loops. The first of these collects each consecutive number and the
          first pitch of the sublist it is paired with (the low pitch), and
          the second collects the same number with the second pitch of the
          sublist (the high pitch).</p> 

        <p>The resulting lists are assigned to the
          variables <code>set-lims-low</code> and <code>set-lims-high</code>,
          which are later paired with the word <code>all</code> (to control the
          tessitura of the entire ensemble rather than individual instruments)
          and passed to the <code>set-limits-high</code> and <code>-low</code>
          keywords of the <code>make-slippery-chicken</code> function. </p>

        <pre class="source">
       (set-lims-low (loop for s in set-lims-progs 
                        collect (first s)
                        collect (first (second s))))
       (set-lims-high (loop for s in set-lims-progs 
                         collect (first s)
                         collect (second (second s))))</pre>

        <p class="close"><a href="#tessitura" id="tessitura-div-hide"
                            class="hideLink"
                            onclick="showHide('tessitura-div');return
                            false;">close</a></p>
      </div>

      <h4 id="call"><a href="#call" id="call-div-show"
                       onclick="showHide('call-div');return false;">+</a>
        The call to make-slippery-chicken</h4>
      <div id="call-div" class="more">
        <p>As with <em>Nouveau Reich</em>, this composition assigns the results
          of the <code>make-slippery-chicken</code> function to a variable, in
          this case <code>tempus-perfectum</code>. The first few keyword
          arguments of the function are either passed straightforward values
          directly (<code>:title</code>, <code>:staff-groupings</code>, and
          <code>:tempo-map</code>), or are passed one of the previously
          declared variables (<code>:ensemble</code>,
          <code>:set-palette</code>, and <code>:set-map</code>). </p>

        <pre class="source">
       (tempus-perfectum
        (make-slippery-chicken
         '+tempus-perfectum+
         :title "Tempus Perfectum"
         :ensemble ens
         :staff-groupings '(3 3 2 3 2)
         :tempo-map '((1 (q 112)))
         :set-palette sp
         :set-map (list (list 1 harms-list))</pre>

        <p class="close"><a href="#call" id="call-div-hide"
                            class="hideLink"
                            onclick="showHide('call-div');return
                            false;">close</a></p>
      </div>

      <h4 id="limits"><a href="#limits" id="limits-div-show"
                       onclick="showHide('limits-div');return false;">+</a>
        Additional set-limits- for individual players</h4>
      <div id="limits-div" class="more">
        <p>In addition to the overall tessitura defined above, the code
          for <em>Tempus Perfectum</em> also sets high and low pitch limits for
          a number of the players in the ensemble. These limits are static and
          assigned for the entire piece using x-values of <code>0</code>
          and <code>100</code> for the break-point pairs. For example, the code
          specifies that the oboe will be given no pitches
          below <code>G4</code>, and that the bassoon, trombone, and cello will
          not have any pitches above <code>G4</code>. </p>

        <pre class="source">
         :set-limits-high `((all ,set-lims-high)
                            (ob (0 a5 100 a5))
                            (bn (0 g4 100 g4))
                            (hn (0 c5 100 c5))
                            (tb (0 g4 100 g4))
                            (va (0 ds5 100 ds5))
                            (vc (0 g4 100 g4)))
         :set-limits-low `((all ,set-lims-low)
                           (ob (0 g4 100 g4))
                           (hn (0 c3 100 c3))
                           (tp (0 c4 100 c4))
                           (tb (0 a2 100 a2))
                           (vn (0 d4 100 d4)))</pre>

        <p class="close"><a href="#limits" id="limits-div-hide"
                            class="hideLink"
                            onclick="showHide('limits-div');return
                            false;">close</a></p>
      </div>

      <h4 id="rests"><a href="#rsp" id="rests-div-show"
                       onclick="showHide('rests-div');return false;">+</a>
        Multi-bar rthm-seqs with lots of rests</h4>
      <div id="rests-div" class="more">
        <p>In defining the <code>rthm-seq-palette</code>, much attention is
          given in <em>Tempus Perfectum</em> to ensuring that there are a
          considerable number of full-bar rests in the
          multi-bar <code>rthm-seqs</code>. This is done to allow for more
          differentiated orchestration and more discernible combinations
          of <em>motifs</em> when they are superimposed.</p>

        <p>Only one <code>pitch-seq</code> curve is defined for
          each <code>rthm-seq</code>, but the <code>rthm-seqs</code> in this
          piece are assigned specific <code>marks</code> that will be present
          in the score each time the corresponding <code>rthm-seq</code>
          appears. </p>

        <pre class="source">
         :rthm-seq-palette '((1 ((((3 4) - e (s) s - +q { 3 (te) - te te - })
                                  ((h.))
                                  ((h.))
                                  ((h.))
                                  ((h.))
                                  ((h.)))
                                 :pitch-seq-palette ((1 3 2 3))
                                 :marks (ppp 1 pp 2 ppp 3 cresc-beg 3 cresc-end
                                             4 )))
                             (2 ((((3 4) (h.))
                                  ((h.))
                                  (- e.. 32 - { 3 - +te te te } - - +s s - (e))
                                  (- s. 32 +e - - s s - (e) (q))
                                  ((s) - s (s) s - (q) - e e -)
                                  ((h.)))
                                 :pitch-seq-palette ((5 7 9 7 6 7 6 9 5 6 3 1
                                                        2))
                                 :marks (mf 1 s 1 2 p 3 mf 7 s 7 8 ppp 9 s 12
                                            13)))
                             (3 ((((3 4) (h.))
                                  ((q) q { 3 (ts) ts (ts) } e )
                                  (- e s s - +q q)
                                  ({ 3 (ts) - ts ts - } (e) { 3 (ts) te } 
                                     { 3 - +te ts - } q) 
                                  (h.)
                                  (+q - +e s - (s) q))
                                 :pitch-seq-palette ((10 5 7 1 3 4 10 14 8 6 7
                                                         6 10 12 7))
                                 :marks (pp 1 cresc-beg 1 cresc-end 2 f 2 p 3
                                            mf 4 dim-beg 4 dim-end 9 pp 9 mf 11
                                            dim-beg 11 dim-end 15 ppp 15
                                            cresc-beg 15 cresc-end 16 f 16 s
                                            17 mf 18 te 18)))
                             (4 ((((3 4) { 5 - fe fs fs fs - } { 3 te tq } 
                                   - +e e -)
                                  ((h.))
                                  (q (q) (e) e)
                                  ((e) e (h)) 
                                  (- s s - (e) - e (s) s - - e e -)
                                  ((e.) s +h))
                                 :pitch-seq-palette ((9 7 8 6 3 1 9 9 8 8 7 8 3
                                                        8 2 1 (9)))
                                 :marks (mf 1 dim-beg 1 s 4 ppp 6 dim-end 6 mf
                                            8 at 8 cresc-beg 8 cresc-end 11 f
                                            11 s 12 p 13 a 15 s 16 at 17 mf
                                            17)))
                             (5 ((((3 4) (e) q. - +s e. -)
                                  (e (e) (s) - e s - +e (e))
                                  (e (e) (e.) s - +e. s -)
                                  (- +s e. - (e.) s (q)) 
                                  (e (e) (h))
                                  (e (e) (h)))
                                 :pitch-seq-palette ((1 2 (5) 1 3 2 3 2 1 1 1 
                                                        (5)))
                                 :marks (fff 1 dim-beg 1 mf 3 dim-end 3 ppp 4
                                             cresc-beg 8 cresc-end 9 cresc-beg 
                                             11 cresc-end 13 f 15)))
                             (6 ((((3 4) (h.))
                                  ((e) e (h))
                                  ((h.))
                                  ((h.)) 
                                  ((h.))
                                  ((q) e (e) (q)))
                                 :pitch-seq-palette ((1 (1)))
                                 :marks (p 1 f 2)))
                             (7 ((((3 4) e (e) { 3 - ts ts ts - } (e) (q))
                                  ((h.))
                                  ((h.))
                                  ((h.)) 
                                  ((e..) 32 - e e - (q))
                                  ((h.)))
                                 :pitch-seq-palette ((2 5 4 3 1 6 7))
                                 :marks (ppp 1)))
                             (8 ((((3 4) (h.))
                                  ((h.))
                                  ((h) (e..) 32)
                                  (e (e) (h)) 
                                  ((h.))
                                  (h (q)))
                                 :pitch-seq-palette ((4 1 (2)))
                                 :marks (ppp 1 ff 3))))</pre>

        <h5>A cmn-display of the rthm-seq-palette</h5>
        <p>A <code>cmn-display</code> processing of the above palette produces
          the following graphic:</p>

        <!-- for a 150ppi CMN png fragment scale width by .6 -->
        <table class="image">
          <tr><td><img class="fragment"
                       src="./resources/tempus-perfectum-rsp.png"
                       alt="tempus-perfectum-rsp.png" width="680" /></td></tr>
          <caption>NB: This graphic was created by applying
            the <code>cmn-display</code> method directly to a
            <code>set-palette</code> object. See the page
            on <a href="./output.html#cmn-frags">output</a> for more detail on
            this feature.</caption>
        </table>

        <p class="close"><a href="#rests" id="rests-div-hide" class="hideLink"
                            onclick="showHide('rests-div');return
                            false;">close</a></p>
      </div>


      <h4>Incorporating CLM and sound files into the composition</h4>
      <h5 id="separate"><a href="#separate" id="separate-div-show"
                           onclick="showHide('separate-div');return
                           false;">+</a>
        Adding separate computer players to the ensemble</h5>
      <div id="separate-div" class="more">
        <p>In order to generate rhythmically and melodically independent
          computer parts for the piece, two separate computer players are added
          to the ensemble. These are given the IDs <code>c1</code>
          and <code>c2</code>, and assigned the <code>computer</code>
          instrument from
          the <code>+slippery-chicken-standard-instrument-palette</code>:</p>

        <pre class="source">
            '(((ob (oboe :midi-channel 1))
               (cl (b-flat-clarinet :midi-channel 2))
               (bn (bassoon :midi-channel 3))
               (hn (french-horn :midi-channel 4))
               (tp (c-trumpet :midi-channel 5))
               (tb (tenor-trombone :midi-channel 6))
               (pr (piano :midi-channel 7))
               (pl (piano-lh :midi-channel 8))
               (vn (violin :midi-channel 9))
               (va (viola :midi-channel 11))
               (vc (cello :midi-channel 12))
               (c1 (computer :midi-channel 13))
               (c2 (computer :midi-channel 14))))</pre>

        <p>These two parts are also included in the loop that generates
          the <code>rthm-seq-map</code>, as described above.</p>

	<p class="nb">NB: The phrase "computer player" used here does not mean
	  a live performer sitting at a computer and playing it in
	  real-time. Instead, it refers to a <code>player</code> object within
	  the <code>ensemble</code> of the <code>slippery-chicken</code> object
	  that is assigned to the <code>computer</code> instrument of
	  the <code>slippery-chicken-standard-instrument-palette</code>. Each
	  of the two <code>players</code> using the <code>computer</code>
	  instrument in this piece will merely be separate parts (separate
	  rhythmic and pitch structures) that will eventually be used to create
	  fixed-media (non-real-time) "tape" parts, which will most likely be
	  played back using audio software on a computer.</p>

        <p class="close"><a href="#separate" id="separate-div-hide"
                            class="hideLink"
                            onclick="showHide('separate-div');return
                            false;">close</a></p>
      </div>

      <h5 id="setup"><a href="#setup" id="setup-div-show"
                           onclick="showHide('setup-div');return false;">+</a>
        Setting up the output directory and sndfile-palette</h5>
      <div id="setup-div" class="more">
        <p>Next, the output directory for the CLM output and the source sound
          files used to generate that output are specified using
          the <code>:snd-output-dir</code> and <code>:sndfile-palette</code>
          keywords of the <code>make-slippery-chicken</code>
          function.</p> 

        <p>The <code>sndfile-palette</code> uses the previously
          defined <code>sndfile-dir</code> variable to specify the path to the
          location of the source sound files. Since all of the files
          are <code>.wav</code> files, the string <code>"wav"</code> is added
          to the <code>extensions</code> slot of
          the <code>sndfile-palette</code>, with the extension omitted from the
          file names. </p>

        <pre class="source">
       (sndfile-dir
        (concatenate 'string
                     cl-user::+slippery-chicken-home-dir+
                     "doc/manual/resources/"))

       [...]

         :snd-output-dir "/tmp"
         :sndfile-palette `(((vocal-sounds
                              ((voice-womanKP-18 :frequency 1028)
                               (voice-womanKP-20 :frequency 456)
                               (voice-womanKP-21 :frequency 484)
                               (voice-womanKP-22 :frequency 591)
                               (voice-womanKP-23 :frequency 662)
                               (voice-womanKP-26 :frequency 516)
                               (voice-womanKP-29 :frequency 629)))
                             (mouth-pops-clicks
                              ((mouth_pop_2 :frequency 375)
                               (mouth_pop_2a :frequency 798)
                               (mouthnoises2 :frequency 703))))
                            ,(list sndfile-dir)
                            ("wav")))))</pre>

        <h6>One group for each call to clm-play</h6>
        <p>The <code>sndfile-palette</code> is constructed to consist of two
          groups of source sound files, the first being vocalized sounds, the
          second being non-vocalized mouth sounds. These groups are given the
          names <code>vocal-sounds</code> and <code>mouth-pops-clicks</code>,
          which will be used in the two calls to <code>clm-play</code>
          below.</p> 

        <h6>Preparing pitch-synchronous transposition of the source files</h6>
        <p>Fundamental frequencies are specified for each of the sound files,
          as the calls to <code>clm-play</code> will employ
          the <code>pitch-synchronous</code> option. </p>

        <p class="close"><a href="#setup" id="setup-div-hide"
                            class="hideLink"
                            onclick="showHide('setup-div');return
                            false;">close</a></p>
      </div>


      <h5 id="generating"><a href="#generating" id="generating-div-show"
                           onclick="showHide('generating-div');return
                           false;">+</a> 
        Generating the computer parts</h5>
      <div id="generating-div" class="more">
        <p>The two computer parts are then produced by using separate calls
          to <a href="../robodoc/slippery-chicken_lsp.html#slippery2dchicken2fclm2dplay"><code>clm-play</code></a>
          for each sound file group and each computer player, specifying values
          for a number of the method's keyword arguments. These calls also make
          use of the previously defined variable <code>src-width</code>, which
          is set to <code>50</code> to produce a slightly higher quality of
          sample interpolation when transposing the sound files.</p>

        <pre class="source">
       (src-width 50)

       [...]

  (clm-play tempus-perfectum 1 '(c1) 'vocal-sounds
            :rev-amt 0.07
            :reset-snds-each-rs nil
            :pitch-synchronous t
            :src-width src-width
            :srate 44100
            :header-type clm::mus-aiff
            :data-format clm::mus-bshort
            :sndfile-extension ".aiff")
  (clm-play tempus-perfectum 1 '(c2) 'mouth-pops-clicks
            :rev-amt 0.07
            :reset-snds-each-rs nil
            :pitch-synchronous t
            :src-width src-width
            :srate 44100
            :header-type clm::mus-aiff
            :data-format clm::mus-bshort
            :sndfile-extension ".aiff")</pre>

        <h6>Required arguments</h6>
        <p>The first required argument to <code>clm-play</code> is
          the <code>slippery-chicken</code> object itself, and the second is
          the section within the piece from which to start. Since
          <em>Tempus Perfectum</em> has only one section, the
          number <code>1</code> is specified here. The third required argument
          is the ID of the player (or players) whose part is to serve as the
          basis for the resulting CLM output. This is specified
          as <code>c1</code> in the first case and <code>c2</code> in the
          second. The final required argument is the ID of the group of sound
          files specified in the <code>sndfile-palette</code> from which the
          CLM output is to be generated. The <code>c1</code> part is to be
          based on the <code>vocal-sounds</code> group, and the second on
          the <code>mouth-pops-clicks</code> group.</p>

        <h6>Optional keyword arguments</h6>
        <p>Each of the calls to <code>clm-play</code> uses the same optional
          arguments. The same amount of reverb is specified for each output
          file using the <code>rev-amt</code> keyword. Setting
          the <code>reset-snds-each-rs</code> argument to <code>NIL</code>
          causes the method to cycle through the sound files of the given group
          for the whole duration of the piece, without beginning at the head of
          the group with each new <code>rthm-seq</code>. </p>

        <p>Setting the <code>pitch-synchronous</code> argument
          to <code>T</code> causes the method to transpose the source sound
          files to match the specific pitches of the part on which the output
          is based, using the <code>frequency</code> value specified in
          the <code>sndfile-palette</code> as the basis for this
          transposition. The <code>src-width</code> argument determines the
          quality of the interpolation during transposition, as mentioned
          above. </p>

        <p>The last four arguments determine the output format of the files
          that CLM will generate. The <code>srate</code>
          and <code>sndfile-extension</code> arguments determine the sample
          rate and file suffix for the files
          produced. The <code>header-type</code> and <code>data-format</code>
          arguments are CLM arguments and must be preceded by
          the <code>clm::</code> package qualifier. The values given here will
          result in stereo <code>.aiff</code> audio files, with the
          extension <code>.aiff</code> (default is
          otherwise <code>.aif</code>), and with a format of 16-bit integer
          (big endian). More on these arguments can be found on
          the <a href="./sc-and-clm.html">slippery chicken and CLM</a> page of
          the manual.</p>

        <p class="close"><a href="#generating" id="generating-div-hide"
                            class="hideLink"
                            onclick="showHide('generating-div');return
                            false;">close</a></p>
      </div>

      <h4 id="midi-scores"><a href="#midi-scores" id="midi-scores-div-show"
                             onclick="showHide('midi-scores-div');return
                             false;">+</a>
        Generating the MIDI and printable score output</h4>
      <div id="midi-scores-div" class="more">
        <h5>Changing the staff name of the piano left-hand</h5>
        <p>Before generating the printable score output, one last change is
          made to the <code>slippery-chicken</code>
          object. The <code>piano-lh</code> <code>instrument</code> object of
          the <code>+slippery-chicken-standard-instrument-palette+</code> has
          no entry for the <code>staff-name</code>
          and <code>staff-short-name</code> slots, meaning that those slots
          contain <code>NIL</code>. LilyPond handles this by printing blank
          space for the corresponding staff names in the score. CMN, however,
          will print <code>NIL</code> into the score. </p>

        <p>To work around this, the code for <em>Tempus Perfectum</em> sets
          the <code>staff-name</code> slot of the
          corresponding <code>instrument</code> object stored within
          the <code>ensemble</code> slot of the <code>slippery-chicken</code>
          object itself, rather than changing the value in
          the <code>instrument-palette</code>. The <code>setf</code> approach
          to changing slot values is used here rather than
          the <code>set-slot</code> method, though that method could be used as
          well (see the page
          on <a href="./instruments.html#changing">instruments and
          instrument-palettes</a> for more detail.)</p>

        <pre class="source">
  (setf (staff-name (get-data-data 'pl (ensemble tempus-perfectum))) " ")</pre>

        <h5>Excluding the computer parts from MIDI and score output</h5>
        <p>The calls to <code>midi-play</code>, <code>cmn-display</code>,
          and <code>write-lp-data-for-all</code> then use
          the <code>:voices</code> and <code>:player</code> keywords to exclude
          the computer players from the MIDI and printable score output. This
          is done by specifying in list form the IDs of all players that are to
          be included in the output. Additionally, the <code>:in-c</code>
          argument is set to <code>T</code> to produce C-scores, and
          the <code>:size</code> argument of <code>clm-play</code> is set
          to <code>11</code> to ensure that the full score fits on the
          page.</p>

        <pre class="source">
  (midi-play tempus-perfectum 
             :midi-file "/tmp/tempus-perfectum.mid"
             :voices '(ob cl bn hn tp tb pr pl vn va vc))
  (cmn-display tempus-perfectum
               :file "/tmp/tempus-perfectum.eps"
               :size 11 
               :players '(ob cl bn hn tp tb pr pl vn va vc)
               :in-c t)
  (write-lp-data-for-all tempus-perfectum
                         :players '(ob cl bn hn tp tb pr pl vn va vc)
                         :in-c t))</pre>


      <h5>Adding the \midi { } command to the LilyPond score file</h5>
      <p>A final step was undertaken to produce the MP3 of the MIDI mock-up
        for this tutorial. The <code>midi-play</code> method of
        the <code>slippery-chicken</code> class only reflects static dynamics
        in the score, without implementing crescendos/diminuendos or
        articulation. The LilyPond application is capable of producing a MIDI
        file that reflects articulation and gradual dynamic changes slightly
        more accurately (though the authors of that program too explicitly
        state that LilyPond is not made for MIDI).</p>

      <p>In order to have LilyPond produce a <em>second</em> MIDI file, the
        resulting <code>_tempus-perfectum-score.ly</code> file produced
        by <code>write-lp-data-for-all</code> was edited prior to having
        LilyPond render the PDF of the score, by inserting one simple line,
        namely <code>\midi { }</code>, as seen below. </p>

      <p>The MIDI file produced by LilyPond
        (<code>_tempus-perfectum-score.midi</code>) will have separate tracks
        for each player, but all program numbers (patches) will be set
        to <code>1</code> (Acoustic Grand Piano) by default. This was not an
        issue when producing the MIDI mock-up for <em>Tempus Perfectum</em>, as
        the resulting MIDI file was then imported into a MIDI sequencer and the
        tracks were manually assigned to instrument tracks that used
        sample-based VST plug-ins.</p>

      <pre class="source">
\version "2.14.2"
\include "tempus-perfectum-def.ly"
\header {
  title ="Tempus Perfectum" 
  tagline = ##f
  composer = ##f
}
\score {
  \keepWithTag #'score \music
  \midi { }
  \layout { }
}</pre>

        <p class="close"><a href="#midi-scores" id="midi-scores-div-hide"
                            class="hideLink"
                            onclick="showHide('midi-scores-div');return
                            false;">close</a></p>
      </div>

    <!-- **************************************************************** --> 
    <!-- This spacer <br> is necessary as a buffer between the content and
         the footer. It cannot be added as padding to #push, since #push has to
         be the same size as #footer in order for the dynamic placement to work
         properly --> 
    <br /><br />
    <div id="push"></div>
    </div>
    <script type="text/javascript">footer();</script>
    <noscript>Your browser does not support JavaScript!</noscript>
  </body>
</html>
