<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>slippery chicken documentation - tonal composition with sc</title> 
    <!-- change the following two file paths to be ../ if in a subdirectory -->
    <link href="../sc-stylesheet.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../head-foot.js"></script>
    <script language="javascript" type="text/javascript"
            src="../show-hide.js"></script>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  </head>
  
  <body onload="showHide(window.location.hash.substring(1)+'-div')" >
    <div id="content">
      <!-- files in the doc directory will call header with argument "./" but
           those in subdirectories will need "../" -->
      <script type="text/javascript">header("../");</script>
      <noscript>Your browser does not support JavaScript!</noscript>
      <!-- **************************************************************** -->

      <h2>Tonal composition with slippery chicken</h2>
      <h3 id="files"><a href="#files" id="files-div-show"
                        onclick="showHide('files-div');return false;">+</a>
        Associated example files</h3>
      <div id="files-div" class="more">
        <ul>
          <li><a href="../examples/tonal-algo-example.lsp">tonal-algo-example.lsp</a></li>  
          <li><a href="../media/tonal.mid">tonal.mid</a></li>  
          <li><a href="../media/tonal.eps">tonal.eps</a></li>  
          <li><a href="../media/_tonal-example-score.pdf">_tonal-example-score.pdf</a></li>   
        </ul>
        <p class="close"><a href="#files" id="files-div-hide" class="hideLink"
                            onclick="showHide('files-div');return
                            false;">close</a></p> 
        <br />
      </div>

      <p><em>slippery chicken</em> was not explicitly designed to produce tonal
        music. However, with a bit of planning and some careful programming, the
        software can be used to algorithmically generate tonal compositions as
        well.</p>

      <p>The approach used in this demo composition defines 17 fixed,
        polyphonic fragments that can be transposed, interchanged, and
        interconnected in a kind of modular composition technique. These
        modules are then assembled algorithmically using a repeatable
        pseudo-random function together with
        the <code>get-linear-sequence</code> method of
        the <code>l-for-lookup</code> class. </p>

      <h3 id="modules"><a href="#modules" id="modules-div-show"
                           onclick="showHide('modules-div');return
                                    false;">+</a> 
        The modules: 3- and 4-voiced improvisation patterns</h3>
      <div id="modules-div" class="more">
        <p>The modules that serve as the building blocks for this piece are
          based on an approach to classical keyboard improvisation and
          voice-oriented (rather than harmony-based) musical analysis taught to
          by Volkhardt Preuss at the Hochschule f&uuml;r Musik und Theater in
          Hamburg, Germany.</p>

        <p>This method collects fundamental musical structures into five basic
          categories: <em>Fauxbourdon</em> (parallel triads in first inversion,
          often with 7-6 suspensions), <em>Ruggiero</em> (Dominant-Tonic
          cadences), <em>Sekundakkord</em> (Dominant-seventh chords with the 7
          in the bass), <em>Orgelpunkt</em> (pedal-point sequences over a
          sustained bass), and <em>Terzfall</em> (falling third sequences). The
          first four of these have been implemented in this piece.</p>

        <p>In this categorical approach, the five pattern types are first
          reduced and presented as core sequences, in which all of the voices
          progress in simultaneous half-note motion. This half-note basis can
          then be extended and elaborated (possibly over several measures) to
          create more fluid music. The demo composition in this tutorial sticks
          to just the short, core progressions with half-note motion.</p>

        <br />
        <!-- for a 150ppi CMN png fragment scale width by .6 -->
        <table class="image">
          <tr><td><img class="fragment" src="./resources/core-fauxbourdon.png"
                       alt="core-fauxbourdon" width="296" /></td></tr>
          <caption>A core fauxbourdon with no suspensions</caption>
        </table>

        <!-- for a 150ppi CMN png fragment scale width by .6 -->
        <table class="image">
          <tr><td><img class="fragment"
                       src="./resources/expanded-fauxbourdon.png"
                       alt="expanded-fauxbourdon" width="449" /></td></tr>
          <caption>An elaborated version of the same fauxbourdon with
            octave-displaced voice-crossings (from Bach's WTK I, Prelude
            2)</caption> 
        </table>

        <p class="close"><a href="#modules" id="modules-div-hide"
              class="hideLink" onclick="showHide('modules-div');return
              false;">close</a></p>
      </div>

      <h3 id="pitches"><a href="#pitches" id="pitches-div-show"
                        onclick="showHide('pitches-div');return false;">+</a>
        <em>sc's</em> pitch-selection algorithm and voice-leading</h3>
      <div id="pitches-div" class="more">
        <p><em>slippery chicken's</em> automatic pitch-selection algorithm was
          designed to produce atonal music, and it needs the use of some
          creative constraints to get it to produce tonal melodies with
          traditional voice-leading.</p>

        <p>Because <em>slippery chicken</em> uses the same pitch set for all
          players in any given sequence, the approach taken here is to confine
          each set to different subsets for each player in each sequence using
          the <code>set-limits-high</code> and <code>set-limits-low</code>
          slots, thereby enabling an exact mapping of the numbers in
          each <code>pitch-seq</code> to specific pitches of the current
          set.</p>

        <p>The code for this composition applies this technique once for
          each <code>rthm-seq</code>, and then transposes the pitch sets using
          the <code>transposition</code> slot of the <code>set-palette</code>
          object, thereby ensuring that the same scale degrees are selected for
          the pitches of each <code>rthm-seq</code> when
          that <code>rthm-seq</code> is repeated in conjunction with different
          sets. </p>

        <p class="close"><a href="#pitches" id="pitches-div-hide"
              class="hideLink" onclick="showHide('pitches-div');return
              false;">close</a></p>
      </div>

      <h3 id="p2psq"><a href="#p2psq" id="p2psq-div-show"
                        onclick="showHide('p2psq-div');return false;">+</a>
        Converting note-names to pitch-seq numbers</h3>
      <div id="p2psq-div" class="more">
        <p>A small function has been written for this piece that makes it
          easier to determine the numbers required for the
          tonal <code>pitch-seqs</code>. It takes as its two arguments a list
          of note-name symbols that are to be converted
          into <code>pitch-seq</code> numbers, and the "source" list of
          note-name symbols to which the <code>pitch-seq</code> numbers are to
          be applied. </p>

        <p>This function allows the user to enter note-name symbols directly,
          which are then automatically converted into <code>pitch-seq</code>
          numbers, rather than counting through all the pitches in the set or
          subset to determine which numbers are needed in order to produce
          them. The function requires that
          the <code>:avoid-melodic-octaves</code>
          and <code>:avoid-used-notes</code> arguments of
          the <code>make-slippery-chicken</code> function are both set
          to <code>NIL</code> in order to work properly.</p>

        <p>Every pitch in the first list must be present in the "source" list
          (second argument) to prevent errors. Enharmonically equivalent
          pitches are not considered equal; the note-name symbols must be exact
          (i.e. <code>GS4</code> must be written as <code>GS4</code> and
          not <code>AF4</code>). The function then determines the
          resulting <code>pitch-seq</code> numbers by returning
          the <tt>position</tt> (index number) of each specified pitch in the
          source set and subtracting the required offset so that the lowest
          pitch is always <tt>1</tt>.</p>

        <pre class="source">
(defun pitches-to-pseq (pitch-list set)
  (let* (positions lowest pseq)
    (setf positions (mapcar #'(lambda (x) (position x set)) pitch-list))
    (setf lowest (1- (first (sort (copy-list positions) #'&lt;))))
    (setf pseq (mapcar #'(lambda (x) (- x lowest)) positions))
    pseq))</pre>

        <pre class="source">
SC> (pitches-to-pseq '(c4 e4 g4 f4 d4 e4 c4) '(a3 b3 c4 d4 e4 f4 g4 a4))
(1 3 5 4 2 3 1)</pre>
        
        <p class="close"><a href="#p2psq" id="p2psq-div-hide"
              class="hideLink" onclick="showHide('p2psq-div');return
              false;">close</a></p>
      </div>


      <h3 id="sets"><a href="#sets" id="sets-div-show"
                        onclick="showHide('sets-div');return false;">+</a>
        Generating the set-palette with :transposition</h3>
      <div id="sets-div" class="more">
        <h4>Core sets</h4>
        <p>The code for this piece uses two primary sets: one that is
          predominantly major, with chromatic passing pitches, and one that is
          predominantly minor, also with chromatic passing pitches. These are
          defined at the top of the variable declarations within
          the <code>let*</code> enclosure. Since
          the <code>pitches-to-pseq</code> function requires exact note-name
          symbols, the sets contain both enharmonic spellings of some of the
          pitches, such as <code>fs4</code> and <code>gf4</code>.</p>

        <pre class="source">
       (core-set-maj '(g2 a2 bf2 b2 c3 d3 ef3 e3 f3 g3 a3 b3 c4 cs4 d4 ef4 e4
                       f4 fs4 gf4 g4 gs4 af4 a4 bf4 b4 c5 d5 e5 f5 fs5 g5 b5
                       c6))
       (core-set-min '(g2 af2 bf2 c3 ef3 f3 fs3 g3 af3 bf3 b3 c4 d4 ef4 e4 f4
                       fs4 gf4 g4 af4 a4 bf4 b4 c5 ef5 e5 f5))</pre>

        <h4>Using a loop to create the set-palette</h4>
        <p>The following loop is used to create the <code>set-palette</code>
          and assign it to the variable <code>sp</code>:</p>

        <!-- MDE Tue Oct 16 17:32:28 2012 -- rather than (= i 0) you might want
             to use the (faster) (zerop i) -->
        <pre class="source">
       (sp 
        (loop for i from 0 to 11
           if (= i 0)
           collect (list "0-MAJ" (list core-set-maj))
           and collect (list "0-MIN" (list core-set-min))
           else 
           collect (list (format nil "~a-MAJ" i)
                         (list "0-MAJ" ':transposition i))
           and collect (list (format nil "~a-MIN" i)
                             (list "0-MIN" ':transposition i))))</pre>

        <h4>The :transposition slot</h4>
        <p>The <code>set-palette</code> is assembled automatically in the loop
          by collecting 12 transpositions (from <code>0</code>
          to <code>11</code> semitones) of each of the <code>core-set-</code>
          variables declared above. The integer value passed to
          the <code>:transposition</code> slot of a set within
          a <code>set-palette</code> object will automatically transpose the
          source set by that many semitones.</p> 

        <p>Assembling the <code>set-palette</code> in this way means there will
          be one major and one minor set for each of the 12 chromatic
          pitch-classes (<code>0</code> = C, <code>1</code> =
          C-sharp, <code>2</code> = D, etc.). Modulating to a different key
          within the piece, then, is made possible by selecting the
          corresponding set in the <code>set-map</code>.</p>

       <h4>Using strings as IDs</h4>
       <!-- MDE Tue Oct 16 17:34:18 2012 -- strings are fine of course but you
            can also use read-from-string e.g. check out (symbolp (print
            (read-from-string "1-MAJ"))) -->
        <p>The IDs for the individual sets of this <code>set-palette</code> are
          strings, such as <code>"0-MAJ"</code> or <code>"0-MIN"</code>, rather
          than the numbers or symbols used in the other tutorials. This allows
          for easier concatenation of numbers and symbols when automatically
          assembling the <code>set-palette</code> within the <code>loop</code>
          macro.</p>

        <p>The same number used for the semitone transposition is combined with
          either <code>"-MAJ"</code> or <code>"-MIN"</code> to create the ID
          for the given set.</p>

        <p>The resulting <code>set-palette</code> would thus look like this,
          if written out in full:</p>

        <pre class="source">
(("0-MAJ"
  ((G2 A2 BF2 B2 C3 D3 EF3 E3 F3 G3 A3 B3 C4 CS4 D4 EF4 E4 F4 FS4 GF4 G4
    GS4 AF4 A4 BF4 B4 C5 D5 E5 F5 FS5 G5 B5 C6)))
 ("0-MIN"
  ((G2 AF2 BF2 C3 EF3 F3 FS3 G3 AF3 BF3 B3 C4 D4 EF4 E4 F4 FS4 GF4 G4 AF4
    A4 BF4 B4 C5 EF5 E5 F5)))
 ("1-MAJ" ("0-MAJ" :TRANSPOSITION 1)) 
 ("1-MIN" ("0-MIN" :TRANSPOSITION 1))
 ("2-MAJ" ("0-MAJ" :TRANSPOSITION 2)) 
 ("2-MIN" ("0-MIN" :TRANSPOSITION 2))
 ("3-MAJ" ("0-MAJ" :TRANSPOSITION 3)) 
 ("3-MIN" ("0-MIN" :TRANSPOSITION 3))
 ("4-MAJ" ("0-MAJ" :TRANSPOSITION 4)) 
 ("4-MIN" ("0-MIN" :TRANSPOSITION 4))
 ("5-MAJ" ("0-MAJ" :TRANSPOSITION 5)) 
 ("5-MIN" ("0-MIN" :TRANSPOSITION 5))
 ("6-MAJ" ("0-MAJ" :TRANSPOSITION 6)) 
 ("6-MIN" ("0-MIN" :TRANSPOSITION 6))
 ("7-MAJ" ("0-MAJ" :TRANSPOSITION 7)) 
 ("7-MIN" ("0-MIN" :TRANSPOSITION 7))
 ("8-MAJ" ("0-MAJ" :TRANSPOSITION 8)) 
 ("8-MIN" ("0-MIN" :TRANSPOSITION 8))
 ("9-MAJ" ("0-MAJ" :TRANSPOSITION 9)) 
 ("9-MIN" ("0-MIN" :TRANSPOSITION 9))
 ("10-MAJ" ("0-MAJ" :TRANSPOSITION 10))
 ("10-MIN" ("0-MIN" :TRANSPOSITION 10))
 ("11-MAJ" ("0-MAJ" :TRANSPOSITION 11))
 ("11-MIN" ("0-MIN" :TRANSPOSITION 11)))</pre>

        <p class="close"><a href="#sets" id="sets-div-hide"
              class="hideLink" onclick="showHide('sets-div');return
              false;">close</a></p>
      </div>

      <h3 id="linear-lfl"><a href="#linear-lfl" id="linear-lfl-div-show"
                        onclick="showHide('linear-lfl-div');return false;">+</a>
        Using the l-for-lookup class for harmonic progressions</h3>
      <div id="linear-lfl-div" class="more">

        <p>The <code>l-for-lookup</code> class has a method called
          <code>get-linear-sequence</code> which lends itself to the generation
          of harmonic progressions. Instead of using the <em>rules</em> of a
          standard <code>l-for-lookup</code> (Lindenmayer System) object to
          create its resulting list by substitution (or rewriting), it uses
          them in rotation.  </p>

        <p>Each time a particular rule-data pair is accessed, the method selects
          the <em>next</em> item in the data list associated with the given
          rule. When it has used the last item in a data list, it cycles around
          and begins at the top of the list the next time that rule-data pair is
          accessed. </p>

        <p>The <code>l-for-lookup</code> object and call
          to <code>get-linear-sequence</code> in this simple example here
          illustrate this method: </p>

        <pre class="source">
(let ((lfl (make-l-for-lookup 'lfl
                              nil
                              '((1 (2 3))
                                (2 (1))
                                (3 (1 2))))))
  (get-linear-sequence lfl 1 30))

=> (1 2 1 3 1 2 1 3 2 1 2 1 3 1 2 1 3 2 1 2 1 3 1 2 1 3 2 1 2 1)</pre>

        <p>The <code>data</code> slot of the <code>l-for-lookup</code> object
          can be set to <code>NIL</code> when used
          with <code>get-linear-sequence</code>, since this method does not use
          that slot. The call to <code>get-linear-sequence</code> states the
          name of the object to access, the first ID to use as a look-up key
          (a.k.a. the "seed" or "axiom"; <code>1</code> in this example), and
          the length of the list to return (<code>30</code> here). </p>

        <p>The method then gets the first item in the rules list associated with
          the seed argument, which in this example is <code>2</code>, and uses
          that item as the look-up ID to get the next item. The only item in
          the list associated with rule <code>2</code> in this example
          is <code>1</code>. The number <code>1</code> is then used again here
          as the look-up ID, but this time it gets the next item from the
          associated data list: <code>3</code>. Now that all items associated
          with rule <code>1</code> have been used, the next time <code>1</code>
          is used as a look-up ID, it will select the first item of the list
          again, namely <code>2</code>, and so on.</p>

        <h4>The procedure for this piece</h4>
        <p>The procedure used to generate the sequence of modules in this piece
          (i.e. the <code>rthm-seq-map</code>) function similarly. Instead of
          using numbers, however, the keys consist of symbols that identify the
          different module types, and the associated data consist of symbols
          that identify the module types to which each given module type may
          progress. The key-data items of this initial object, and the
          resulting list, are used later as keys again to look up data from two
          further association lists, namely <code>transposition-rules-al</code>
          and <code>combos-al</code>.</p>

        <p>The symbol names for each of the module types here are created from
          their kind, their variation, and their modality (major, minor,
          starting major but ending minor, etc.). They each
          represent <em>groups</em> of modules, as defined in
          the <code>combos-al</code> variable below. Each group may have one or
          more possible combination of voices (e.g., the <em>cantizans</em> may
          appear in the soprano voice in one combination, but in the alto voice
          in another, etc.)</p>

        <pre class="source">
       (seq-rules 
        (make-l-for-lookup 'seq-rules
                           nil
                           '((fauxbourdon-a-maj 
                              (ruggiero-a-maj ruggiero-b-maj
                                ruggiero-b-maj-to-min ruggiero-c-maj))
                             (fauxbourdon-a-min 
                              (ruggiero-a-min ruggiero-d-min-to-maj))
                             (ruggiero-a-maj 
                              (fauxbourdon-a-maj sekund-a-maj ped-a-maj))
                             (ruggiero-a-min 
                              (fauxbourdon-a-min sekund-a-min))
                             (ruggiero-b-maj 
                              (fauxbourdon-a-maj sekund-a-maj ped-a-maj))
                             (ruggiero-b-maj-to-min 
                              (fauxbourdon-a-min sekund-a-min))
                             (ruggiero-c-maj 
                              (fauxbourdon-a-maj sekund-a-maj ped-a-maj))
                             (ruggiero-d-min-to-maj 
                              (fauxbourdon-a-maj sekund-a-maj ped-a-maj))
                             (ruggiero-e-maj 
                              (fauxbourdon-a-maj sekund-a-maj ped-a-maj))
                             (sekund-a-maj 
                              (ruggiero-e-maj))
                             (sekund-a-min 
                              (ruggiero-a-min ruggiero-d-min-to-maj))
                             (ped-a-maj 
                              (sekund-a-maj)))))</pre>

        <h4>Getting the linear sequence</h4>
        <p>The sequence of modules is then created by calling
          the <code>get-linear-sequence</code> method with the
          symbol <code>fauxbourdon-a-maj</code> as the seed, and a list length
          of <code>num-seqs</code>, which is the first variable declared in
          this <code>let*</code> enclosure (<code>29</code> here). The
          resulting list is stored in the variable <code>seq-seq</code>.</p>

        <pre class="source">
       (seq-seq (get-linear-sequence seq-rules 'fauxbourdon-a-maj num-seqs))</pre>

        <p>The resulting sequence of modules in this instance is:</p>

        <pre class="source">
(FAUXBOURDON-A-MAJ RUGGIERO-A-MAJ FAUXBOURDON-A-MAJ RUGGIERO-B-MAJ
 FAUXBOURDON-A-MAJ RUGGIERO-B-MAJ-TO-MIN FAUXBOURDON-A-MIN RUGGIERO-A-MIN
 FAUXBOURDON-A-MIN RUGGIERO-D-MIN-TO-MAJ FAUXBOURDON-A-MAJ RUGGIERO-C-MAJ
 FAUXBOURDON-A-MAJ RUGGIERO-A-MAJ SEKUND-A-MAJ RUGGIERO-E-MAJ
 FAUXBOURDON-A-MAJ RUGGIERO-B-MAJ SEKUND-A-MAJ RUGGIERO-E-MAJ SEKUND-A-MAJ
 RUGGIERO-E-MAJ PED-A-MAJ SEKUND-A-MAJ RUGGIERO-E-MAJ FAUXBOURDON-A-MAJ
 RUGGIERO-B-MAJ-TO-MIN SEKUND-A-MIN RUGGIERO-A-MIN)</pre>
        
        <h4>Adding a coda</h4>
        <p>This particular sequence, created using a list length
          of <code>29</code>, generates a sequence that ends with a V-I cadence
          (a <em>ruggiero</em> module). However, not all list lengths will
          generate lists with a ruggiero as their last element; a length
          of <code>30</code>, for example, would generate a sequence that ends
          with <code>SEKUND-A-MIN</code>, and the piece would sound like it
          gets cut off in the middle of a phrase.</p>
        
        <p>To remedy this, a small loop is used to generate a <em>coda</em> if
          necessary. The loop looks at the last item in
          the <code>seq-seq</code> list, and if it does not start with the
          characters <code>RUG</code>, it collects a new linear sequence of
          module symbol names, using the same rules as above, until
          a <em>ruggiero</em> is reached. It saves this new short list to the
          variable <code>coda</code>, which is then appended to the end of
          the <code>seq-seq</code>. The sequence is now complete and will end
          with a V-I cadence.</p>

        <!-- MDE Tue Oct 16 17:48:09 2012 -- instead of using equalp and subseq
             you can just use string= with the :end1 or :end2 keyword -->
        <pre class="source">
       (coda
        (loop
           with l = (first (last seq-seq))
           until (equalp (subseq (format nil "~a" l) 0 3)
                         "RUG")
           do
             (setf l (first (last (get-linear-sequence seq-rules l 2))))
           collect l))
       (seq-seq (append seq-seq coda))</pre>

        <p class="close"><a href="#linear-lfl" id="linear-lfl-div-hide"
              class="hideLink" onclick="showHide('linear-lfl-div');return
              false;">close</a></p>
      </div>

      <h3 id="transp-al"><a href="#transp-al" id="transp-al-div-show"
                        onclick="showHide('transp-al-div');return false;">+</a> 
        An assoc-list object to store transposition rules</h3>
      <div id="transp-al-div" class="more">
        <p>A number of the modules selected for this
          particular <code>slippery-chicken</code> object modulate to different
          keys and different modes (major or
          minor). The <code>ruggiero-b-maj-to-min</code> module, for example,
          starts on the V (Dominant) of a given major key and uses a
          musical <em>sequence</em> to modulate to the minor key three
          half-steps higher (e.g. from C major to E-flat minor). </p>

        <p>Each consecutive set chosen for the <code>set-map</code> is
          therefore dependent on whether the previous module modulates or
          not. Accordingly, then, a list of transposition rules are first
          collected into an association list (an <code>assoc-list</code>
          object), and each of the symbol names defined for each module in
          the <code>l-for-lookup</code> object above are once again used as
          keys to store lists of two items: a positive or negative integer to
          determine the number of half-steps by which the piece is to modulate
          at the end of each module, and a symbol to indicate whether the new
          key is to be major or minor. This <code>assoc-list</code> object is
          stored in the variable <code>transposition-rules-al</code>.</p>

        <pre class="source">
       (transposition-rules-al 
        (make-assoc-list 'transposition-rules
                         '((fauxbourdon-a-maj (0 maj))
                           (fauxbourdon-a-min (0 min))
                           (ruggiero-a-maj (0 maj))
                           (ruggiero-a-min (0 min))
                           (ruggiero-b-maj (3 maj))
                           (ruggiero-b-maj-to-min (3 min))
                           (ruggiero-c-maj (-3 maj))
                           (ruggiero-d-min-to-maj (0 maj))
                           (ruggiero-e-maj (0 maj))
                           (sekund-a-maj (0 maj))
                           (sekund-a-min (0 min))
                           (ped-a-maj (0 maj)))))</pre>

        <p>A small loop is then used to collect the key-change progression by
          calculating the transpositions associated with each of the modules
          listed in the <code>seq-seq</code> variable created above. To this
          end, each item in the <code>seq-seq</code> is consecutively used as
          the key to perform a look-up into
          the <code>transposition-rules-al</code> association list. </p>

        <pre class="source">
       (transpositions-changes 
        (let ((n 0)
              rule)
          (loop for seq in (subseq seq-seq 0 (1- (length seq-seq)))
             do (setf rule (get-data-data seq transposition-rules-al))
             collect (list
                      (setf n (mod (+ n (first rule)) 12))
                      (second rule))))) </pre>

        <p>The resulting list, which is stored in the
          variable <code>transpositions-changes</code>, consists of a series of
          two-item lists, each of which contain the number and symbol
          (<code>MAJ</code> or <code>MIN</code>) required to create the string
          ID of one of the sets in the <code>set-palette</code>. The loop
          therefore performs a cumulative summation of the corresponding
          transposition integers from the <code>transposition-rules-al</code>
          in <em>modulo 12</em> to ensure that the transposition always returns
          a number between <code>0</code> and <code>11</code>, the first part
          of an existing set ID. The results for this particular piece (with 29
          initial sequences) is:</p>

        <pre class="source">
((0 MAJ) (0 MAJ) (0 MAJ) (0 MAJ) (3 MAJ) (3 MAJ) (6 MIN) (6 MIN) (6 MIN)
 (6 MIN) (6 MAJ) (6 MAJ) (3 MAJ) (3 MAJ) (3 MAJ) (3 MAJ) (3 MAJ) (3 MAJ)
 (6 MAJ) (6 MAJ) (6 MAJ) (6 MAJ) (6 MAJ) (6 MAJ) (6 MAJ) (6 MAJ) (6 MAJ)
 (9 MIN) (9 MIN))</pre>

        <p>However, this list is just a list of the key changes that occur at
          the <em>end</em> of each module. In order to have one key
          for <em>each</em> module, the next
          variable, <code>transpositions</code>, pushes <code>(0 MAJ)</code> to
          the head of this list. There is now one key and one mode stored for
          each item in the <code>seq-seq</code></p>

        <pre class="source">
       (transpositions (push '(0 MAJ) transpositions-changes))</pre>

        <p class="close"><a href="#transp-al" id="transp-al-div-hide"
              class="hideLink" onclick="showHide('transp-al-div');return
              false;">close</a></p>
      </div>

      <h3 id="sm"><a href="#sm" id="sm-div-show"
                     onclick="showHide('sm-div');return false;">+</a>
        Assembling the set-map from the transpositions list</h3>
      <div id="sm-div" class="more">
        <p>The <code>set-map</code> is then created from
          the <code>transpositions</code> variable. A small loop collects a
          list of strings constructed by concatenating the integer from each
          two-item list with the corresponding symbol.</p>

        <pre class="source">
       (sm 
        (loop for trnsp in transpositions
           collect (format nil "~a-~a" (first trnsp) (second trnsp))))</pre>

        <p>Each of these strings will be equal to the ID of one of the
          transposed sets in the <code>set-palette</code>. The resulting list
          is stored in the variable <code>sm</code>, which is passed directly
          to the <code>set-map</code> slot of the <code>slippery-chicken</code>
          object made below. The <code>set-map</code> for this particular
          sequence of 29 modules looks like this:</p>

        <pre class="source">
("0-MAJ" "0-MAJ" "0-MAJ" "0-MAJ" "3-MAJ" "3-MAJ" "6-MIN" "6-MIN" "6-MIN"
 "6-MIN" "6-MAJ" "6-MAJ" "3-MAJ" "3-MAJ" "3-MAJ" "3-MAJ" "3-MAJ" "3-MAJ"
 "6-MAJ" "6-MAJ" "6-MAJ" "6-MAJ" "6-MAJ" "6-MAJ" "6-MAJ" "6-MAJ" "6-MAJ"
 "9-MIN" "9-MIN")</pre>


        <p class="close"><a href="#sm" id="sm-div-hide" class="hideLink"
              onclick="showHide('sm-div');return false;">close</a></p>
      </div>

      <h3 id="combos"><a href="#combos" id="combos-div-show"
                     onclick="showHide('combos-div');return false;">+</a>
        An assoc-list object to store module combinations</h3>
      <div id="combos-div" class="more">
        <p>As mentioned above, each module type named in
          the <code>l-for-lookup</code> object and the
          subsequent <code>seq-seq</code> variable represents a group of
          possible voice combinations that have the same pitch, rhythm, and
          harmonic structure. These combinations are defined in
          another <code>assoc-list</code> object here and assigned to the
          variable <code>combos-al</code>: </p>

        <pre class="source">
       (combos-al
        (make-assoc-list 
         'combos
         '((fauxbourdon-a-maj ((fx-1-maj-c fx-1-maj-a fx-1-maj-t 2-rest)
                               (fx-1-maj-c fx-1-maj-a 2-rest fx-2-maj-t)
                               (fx-3-maj-c fx-1-maj-c 2-rest fx-2-maj-t)))
           (fauxbourdon-a-min ((fx-1-min-c fx-1-min-a fx-1-min-t 2-rest)
                               (fx-1-min-c fx-1-min-a 2-rest fx-2-min-t)))
           (ruggiero-a-maj ((rg-1-maj-c rg-1-maj-a rg-1-maj-t 2-rest)))
           (ruggiero-a-min ((rg-1-min-c rg-1-min-a rg-1-min-t 2-rest)
                            (rg-4-min-c rg-4-min-a 2-rest rg-4-min-b)))
           (ruggiero-b-maj ((rg-2-maj-c rg-2-maj-a 5-rest rg-2-maj-t)))
           (ruggiero-b-maj-to-min ((rg-2-min-c rg-2-min-a 5-rest rg-2-min-t)))  
           (ruggiero-c-maj ((rg-3-maj-c rg-3-maj-a rg-3-maj-t rg-3-maj-b)))
           (ruggiero-d-min-to-maj ((rg-5-min-c rg-5-min-a rg-5-min-t
                                               rg-5-min-b)))
           (ruggiero-e-maj ((rg-6-maj-c rg-6-maj-a 2-rest rg-6-maj-b)))
           (sekund-a-maj ((sek-1-maj-c sek-1-maj-a sek-1-maj-t sek-1-maj-b)
                          (sek-2-maj-c sek-2-maj-a sek-2-maj-t sek-2-maj-b)))
           (sekund-a-min ((sek-3-min-c sek-3-min-a sek-3-min-t sek-3-min-b)))
           (ped-a-maj ((ped-1-maj-c ped-1-maj-a ped-1-maj-t ped-1-maj-b)))))) </pre>

        <p>Each key in this association list is exactly the same as the keys
          in the <code>l-for-lookup</code> object and
          the <code>transposition-rules-al</code>. The data lists associated
          with each key consist of the IDs of <code>rthm-seq</code> objects
          defined in the <code>rthm-seq-palette</code> below.</p>

        <p>Each <code>rthm-seq</code> below consists of one voice within one of
          the modules. Each data item in the <code>combos-al</code> is
          therefore a set of four <code>rthm-seq</code> IDs, one for each
          player. These are first collected here in combination to make the
          identification easier for the programmer. They will then be
          disassembled and reassembled into the <code>rthm-seq-map</code> in
          the next two steps below.</p>

        <p class="close"><a href="#combos" id="combs-div-hide" class="hideLink"
              onclick="showHide('combos-div');return false;">close</a></p>
      </div>

      <h3 id="rsm"><a href="#rsm" id="rsm-div-show"
                      onclick="showHide('rsm-div');return false;">+</a> 
        Assembling the rthm-seq-map from the combos-al</h3>
      <div id="rsm-div" class="more">
        <h4>Collecting the random combos first</h4>
        <p>A small loop is first used to collect the list
          of <code>rthm-seq</code> combinations for the
          subsequent <code>rthm-seq-map</code>. It passes through the list of
          module types stored in the <code>seq-seq</code> variable and uses
          each one as a look-up key into the <code>combos-al</code>. It uses
          <em>slippery chicken's</em> own <code>random-rep</code> function to
          select a random voice combo from the data list associated with each
          module type.</p>

        <pre class="source">
       (rsm-combos 
        (let* (c)
          (random-rep 1 t) ; reset random state each time for same results
          (loop for s in seq-seq
             do (setf c (get-data-data s combos-al))
             collect
               (nth (random-rep (length c)) c))))</pre>

        <p>The <code>random-rep</code> function has an optional argument that
          allows the user to reset the current Lisp's random state, allowing
          for the exact same list of randomly selected items to be returned
          each time. In this example, <code>random-rep</code> is called first,
          prior to the loop, so that the random state is reset. The result of
          this loop is stored in the <code>rsm-combos</code> variable and
          produces the following list for this example: </p>

        <p class="nb">Update 19.6.13: The random-rep function has been replaced
        with a hard-coded list in
        <a
        href="../examples/tonal-algo-example.lsp">tonal-algo-example.lsp</a></li>
        so that the enharmonic corrections done 'by hand' still function when
        the file is run in any version of Lisp.

        <pre class="source">
((FX-1-MAJ-C FX-1-MAJ-A FX-1-MAJ-T 2-REST)
 (RG-1-MAJ-C RG-1-MAJ-A RG-1-MAJ-T 2-REST)
 (FX-1-MAJ-C FX-1-MAJ-A FX-1-MAJ-T 2-REST)
 (RG-2-MAJ-C RG-2-MAJ-A 5-REST RG-2-MAJ-T)
 (FX-1-MAJ-C FX-1-MAJ-A FX-1-MAJ-T 2-REST)
 (RG-2-MIN-C RG-2-MIN-A 5-REST RG-2-MIN-T)
 (FX-1-MIN-C FX-1-MIN-A 2-REST FX-2-MIN-T)
 (RG-4-MIN-C RG-4-MIN-A 2-REST RG-4-MIN-B)
 (FX-1-MIN-C FX-1-MIN-A 2-REST FX-2-MIN-T)
 (RG-5-MIN-C RG-5-MIN-A RG-5-MIN-T RG-5-MIN-B)
 (FX-1-MAJ-C FX-1-MAJ-A FX-1-MAJ-T 2-REST)
 (RG-3-MAJ-C RG-3-MAJ-A RG-3-MAJ-T RG-3-MAJ-B)
 (FX-1-MAJ-C FX-1-MAJ-A FX-1-MAJ-T 2-REST)
 (RG-1-MAJ-C RG-1-MAJ-A RG-1-MAJ-T 2-REST)
 (SEK-2-MAJ-C SEK-2-MAJ-A SEK-2-MAJ-T SEK-2-MAJ-B)
 (RG-6-MAJ-C RG-6-MAJ-A 2-REST RG-6-MAJ-B)
 (FX-3-MAJ-C FX-1-MAJ-C 2-REST FX-2-MAJ-T)
 (RG-2-MAJ-C RG-2-MAJ-A 5-REST RG-2-MAJ-T)
 (SEK-2-MAJ-C SEK-2-MAJ-A SEK-2-MAJ-T SEK-2-MAJ-B)
 (RG-6-MAJ-C RG-6-MAJ-A 2-REST RG-6-MAJ-B)
 (SEK-1-MAJ-C SEK-1-MAJ-A SEK-1-MAJ-T SEK-1-MAJ-B)
 (RG-6-MAJ-C RG-6-MAJ-A 2-REST RG-6-MAJ-B)
 (PED-1-MAJ-C PED-1-MAJ-A PED-1-MAJ-T PED-1-MAJ-B)
 (SEK-2-MAJ-C SEK-2-MAJ-A SEK-2-MAJ-T SEK-2-MAJ-B)
 (RG-6-MAJ-C RG-6-MAJ-A 2-REST RG-6-MAJ-B)
 (FX-1-MAJ-C FX-1-MAJ-A FX-1-MAJ-T 2-REST)
 (RG-2-MIN-C RG-2-MIN-A 5-REST RG-2-MIN-T)
 (SEK-3-MIN-C SEK-3-MIN-A SEK-3-MIN-T SEK-3-MIN-B)
 (RG-1-MIN-C RG-1-MIN-A RG-1-MIN-T 2-REST))</pre>

        <h4>Separating the list of combos into a list for the rthm-seq-map</h4>
        <p>The next little loop then parses the <code>rsm-combos</code> list
          into separate lists for each player, with the syntax necessary to
          make a <code>rthm-seq-map</code> object, and stores the resulting
          list in the variable <code>rsm</code>. This variable will then be
          used directly within the call
          to <code>make-slippery-chicken</code>. </p>

        <pre class="source">
       (rsm 
        (loop for p in '(vo vt va vc)
           for n from 0
           collect
             (list p 
                   (flatten
                    (loop for c in rsm-combos
                       collect 
                         (list (nth n c)))))))</pre>

        <p>The result of this loop for this example is as follows:</p>

        <pre class="source">
((VO
  (FX-1-MAJ-C RG-1-MAJ-C FX-1-MAJ-C RG-2-MAJ-C FX-1-MAJ-C RG-2-MIN-C
   FX-1-MIN-C RG-4-MIN-C FX-1-MIN-C RG-5-MIN-C FX-1-MAJ-C RG-3-MAJ-C
   FX-1-MAJ-C RG-1-MAJ-C SEK-2-MAJ-C RG-6-MAJ-C FX-3-MAJ-C RG-2-MAJ-C
   SEK-2-MAJ-C RG-6-MAJ-C SEK-1-MAJ-C RG-6-MAJ-C PED-1-MAJ-C SEK-2-MAJ-C
   RG-6-MAJ-C FX-1-MAJ-C RG-2-MIN-C SEK-3-MIN-C RG-1-MIN-C))
 (VT
  (FX-1-MAJ-A RG-1-MAJ-A FX-1-MAJ-A RG-2-MAJ-A FX-1-MAJ-A RG-2-MIN-A
   FX-1-MIN-A RG-4-MIN-A FX-1-MIN-A RG-5-MIN-A FX-1-MAJ-A RG-3-MAJ-A
   FX-1-MAJ-A RG-1-MAJ-A SEK-2-MAJ-A RG-6-MAJ-A FX-1-MAJ-C RG-2-MAJ-A
   SEK-2-MAJ-A RG-6-MAJ-A SEK-1-MAJ-A RG-6-MAJ-A PED-1-MAJ-A SEK-2-MAJ-A
   RG-6-MAJ-A FX-1-MAJ-A RG-2-MIN-A SEK-3-MIN-A RG-1-MIN-A))
 (VA
  (FX-1-MAJ-T RG-1-MAJ-T FX-1-MAJ-T 5-REST FX-1-MAJ-T 5-REST 2-REST 2-REST
   2-REST RG-5-MIN-T FX-1-MAJ-T RG-3-MAJ-T FX-1-MAJ-T RG-1-MAJ-T
   SEK-2-MAJ-T 2-REST 2-REST 5-REST SEK-2-MAJ-T 2-REST SEK-1-MAJ-T 2-REST
   PED-1-MAJ-T SEK-2-MAJ-T 2-REST FX-1-MAJ-T 5-REST SEK-3-MIN-T
   RG-1-MIN-T))
 (VC
  (2-REST 2-REST 2-REST RG-2-MAJ-T 2-REST RG-2-MIN-T FX-2-MIN-T RG-4-MIN-B
   FX-2-MIN-T RG-5-MIN-B 2-REST RG-3-MAJ-B 2-REST 2-REST SEK-2-MAJ-B
   RG-6-MAJ-B FX-2-MAJ-T RG-2-MAJ-T SEK-2-MAJ-B RG-6-MAJ-B SEK-1-MAJ-B
   RG-6-MAJ-B PED-1-MAJ-B SEK-2-MAJ-B RG-6-MAJ-B 2-REST RG-2-MIN-T
   SEK-3-MIN-B 2-REST)))</pre>

        <p class="close"><a href="#rsm" id="rsn-div-hide" class="hideLink"
              onclick="showHide('rsm-div');return false;">close</a></p>
      </div>

      <h3 id="lims"><a href="#lims" id="lims-div-show"
                      onclick="showHide('lims-div');return false;">+</a> 
        set-limits for the C-transpositions of the rthm-seqs</h3>
      <div id="lims-div" class="more">
        <p>The next three variables form the core of this modular approach to
          creating tonal music with <em>slippery chicken</em>, and they involve
          the <code>set-limits-high</code> and <code>set-limits-low</code>
          slots of the <code>slippery-chicken</code> object. </p>

        <p>By constraining the current set for each player in every sequence of
          the piece and setting the <code>:avoid-melodic-octaves</code>
          and <code>:avoid-used-notes</code> keyword arguments of
          the <code>make-slippery-chicken</code> function to <code>NIL</code>,
          the user can enable an exact mapping of the <code>pitch-seq</code>
          numbers of the <code>rthm-seq</code> objects to specific pitches in
          the current set.</p>

        <h4>Defining the pitch limits and storing them in an assoc-list</h4>
        <p>This demo piece does this by first creating
          an <code>assoc-list</code> object that stores the lowest and highest
          pitch of each <code>rthm-seq</code> in its C (0) transposition. Each
          key in this association list (which is assigned to the
          variable <code>lims-al</code>) is identical to the ID of one of
          the <code>rthm-seqs</code> defined in
          the <code>rthm-seq-palette</code> below.</p>

        <pre class="source">
       (lims-al 
        (make-assoc-list 'set-lims
                         '((2-rest (a4 a4))
                           (5-rest (a4 a4))
                           (fx-1-maj-c (fs4 a4))
                           (fx-1-maj-a (b3 e4))
                           (fx-1-maj-t (g3 c4))
                           (fx-1-min-c (fs4 af4))
                           (fx-1-min-a (b3 ef4))
                           (fx-1-min-t (g3 c4))
                           (fx-2-maj-t (g2 c3))
                           (fx-2-min-t (g2 c3))
                           (fx-3-maj-c (b4 e5))
                           (rg-1-maj-c (b4 c5))
                           (rg-1-maj-a (c4 g4))
                           (rg-1-maj-t (c3 g3)) 
                           (rg-1-min-c (b4 c5))
                           (rg-1-min-a (c4 g4))
                           (rg-1-min-t (c3 g3)) 
                           (rg-2-maj-c (ef4 c5))
                           (rg-2-maj-a (c4 f4))
                           (rg-2-maj-t (bf2 g3))
                           (rg-2-min-c (ef4 c5))
                           (rg-2-min-a (c4 f4))
                           (rg-2-min-t (bf2 g3))
                           (rg-3-maj-c (gs4 c5))
                           (rg-3-maj-a (e4 g4))
                           (rg-3-maj-t (b3 e4))
                           (rg-3-maj-b (a2 a3))
                           (rg-4-min-c (b4 c5))
                           (rg-4-min-a (c4 g4))
                           (rg-4-min-b (g2 g3))
                           (rg-5-min-c (b4 c5))
                           (rg-5-min-a (e4 g4))
                           (rg-5-min-t (c4 d4))
                           (rg-5-min-b (g2 af3))
                           (rg-6-maj-c (c5 g5))
                           (rg-6-maj-a (b4 c5))
                           (rg-6-maj-b (c3 g3))
                           (sek-1-maj-c (e5 f5))
                           (sek-1-maj-a (c5 c5))
                           (sek-1-maj-t (f4 g4))
                           (sek-1-maj-b (a2 c3))
                           (sek-2-maj-c (e5 g5))
                           (sek-2-maj-a (c5 d5))
                           (sek-2-maj-t (g4 a4))
                           (sek-2-maj-b (b2 c3))
                           (sek-3-min-c (ef5 f5))
                           (sek-3-min-a (c5 c5))
                           (sek-3-min-t (f4 g4))
                           (sek-3-min-b (af2 c3))
                           (ped-1-maj-c (c5 c5))
                           (ped-1-maj-a (g4 a4))
                           (ped-1-maj-t (e4 f4))
                           (ped-1-maj-b (c3 c3)))))</pre>

        <h4>Creating the set-limits- lists</h4>
        <p>A small loop is then used to collect just the pitches, in MIDI-note
          number form, for the <code>set-limits-low</code>
          and <code>set-limits-high</code> slots for every sequence and every
          player in the piece. It collects them as MIDI-note numbers in order
          to facilitate their transposition in the next step.</p>

        <pre class="source">
       (lims-lo-hi
        (loop for n from 0 to 1
           collect 
             (loop for p in rsm
                collect 
                  (loop for rs in (second p)
                     collect (note-to-midi
                              (nth n (get-data-data rs lims-al)))))))</pre>

        <p>The list created consists of two lists, one for the low set limits
          and one for the high set limits, each of those lists in turn
          containing a list of pitches for each player, with one pitch for each
          sequence. This list is assigned to the
          variable <code>lims-lo-hi</code>. The result of this list in this
          instance with 29 sequences looks like this: </p>

        <pre class="source">
(((66 71 66 63 66 63 66 71 66 71 66 68 66 71 76 72 71 63 76 72 76 72 72 76
   72 66 63 75 71)
  (59 60 59 60 59 60 59 60 59 64 59 64 59 60 72 71 66 60 72 71 72 71 67 72
   71 59 60 72 60)
  (55 48 55 69 55 69 69 69 69 60 55 59 55 48 67 69 69 69 67 69 65 69 64 67
   69 55 69 65 48)
  (69 69 69 46 69 46 43 43 43 43 69 45 69 69 47 48 43 46 47 48 45 48 48 47
   48 69 46 44 69))
 ((69 72 69 72 69 72 68 72 68 72 69 72 69 72 79 79 76 72 79 79 77 79 72 79
   79 69 72 77 72)
  (64 67 64 65 64 65 63 67 63 67 64 67 64 67 74 72 69 65 74 72 72 72 69 74
   72 64 65 72 67)
  (60 55 60 69 60 69 69 69 69 62 60 64 60 55 69 69 69 69 69 69 67 69 65 69
   69 60 69 67 55)
  (69 69 69 55 69 55 48 55 48 56 69 57 69 69 48 55 48 55 48 55 48 55 48 48
   55 69 55 48 69)))</pre>

        <p class="close"><a href="#lims" id="lims-div-hide" class="hideLink"
              onclick="showHide('lims-div');return false;">close</a></p>
      </div>

      <h3 id="transp-lims"><a href="#transp-lims" id="transp-lims-div-show"
                              onclick="showHide('transp-lims-div');return
                              false;">+</a> 
        Transposing the set-limits- curves</h3>
      <div id="transp-lims-div" class="more">
        <p>Since some of the modules in this piece result in transpositions, as
          addressed above, the set limits too must be transposed in order to
          accurately apply to the transposed sets. This is done conveniently
          using a small loop, in which the integer from each two-item sublist
          of the <code>transpositions</code> variable is accessed and added to
          the MIDI-note numbers in the <code>lims-lo-hi</code> list.</p>

        <pre class="source">
       (transposed-lims-lo-hi
        (loop for hl in lims-lo-hi
           collect 
             (loop for p in hl
                for pl in '(vo vt va vc)
                collect
                  (list pl
                        (loop for n in p
                           for i in transpositions
                           for x from 1
                           collect x
                           collect (+ n (first i)))))))</pre>

        <p>This loop also adds the player ID and the sequence number for each
          pitch limit to its output, ensuring that the resulting list has two
          items at the top level: A properly-formatted list for both
          <code>set-limits-low</code> and <code>set-limits-high</code>,
          including player IDs and lists of x-y break-point pairs, that can be
          passed directly to the <code>set-limits-low</code>
          and <code>-high</code> slots from within
          the <code>make-slippery-chicken</code> function below.</p>

        <pre class="source">
(((VO
   (1 66 2 71 3 66 4 63 5 69 6 66 7 72 8 77 9 72 10 77 11 72 12 74 13 69
    14 74 15 79 16 75 17 74 18 66 19 82 20 78 21 82 22 78 23 78 24 82 25
    78 26 72 27 69 28 84 29 80))
  (VT
   (1 59 2 60 3 59 4 60 5 62 6 63 7 65 8 66 9 65 10 70 11 65 12 70 13 62
    14 63 15 75 16 74 17 69 18 63 19 78 20 77 21 78 22 77 23 73 24 78 25
    77 26 65 27 66 28 81 29 69))
  (VA
   (1 55 2 48 3 55 4 69 5 58 6 72 7 75 8 75 9 75 10 66 11 61 12 65 13 58
    14 51 15 70 16 72 17 72 18 72 19 73 20 75 21 71 22 75 23 70 24 73 25
    75 26 61 27 75 28 74 29 57))
  (VC
   (1 69 2 69 3 69 4 46 5 72 6 49 7 49 8 49 9 49 10 49 11 75 12 51 13 72
    14 72 15 50 16 51 17 46 18 49 19 53 20 54 21 51 22 54 23 54 24 53 25
    54 26 75 27 52 28 53 29 78)))
 ((VO
   (1 69 2 72 3 69 4 72 5 72 6 75 7 74 8 78 9 74 10 78 11 75 12 78 13 72
    14 75 15 82 16 82 17 79 18 75 19 85 20 85 21 83 22 85 23 78 24 85 25
    85 26 75 27 78 28 86 29 81))
  (VT
   (1 64 2 67 3 64 4 65 5 67 6 68 7 69 8 73 9 69 10 73 11 70 12 73 13 67
    14 70 15 77 16 75 17 72 18 68 19 80 20 78 21 78 22 78 23 75 24 80 25
    78 26 70 27 71 28 81 29 76))
  (VA
   (1 60 2 55 3 60 4 69 5 63 6 72 7 75 8 75 9 75 10 68 11 66 12 70 13 63
    14 58 15 72 16 72 17 72 18 72 19 75 20 75 21 73 22 75 23 71 24 75 25
    75 26 66 27 75 28 76 29 64))
  (VC
   (1 69 2 69 3 69 4 55 5 72 6 58 7 54 8 61 9 54 10 62 11 75 12 63 13 72
    14 72 15 51 16 58 17 51 18 58 19 54 20 61 21 54 22 61 23 54 24 54 25
    61 26 75 27 61 28 57 29 78))))</pre>

        <p class="close"><a href="#transp-lims" id="transp-lims-div-hide"
              class="hideLink" onclick="showHide('transp-lims-div');return
              false;">close</a></p>
      </div>

      <h3 id="rs-vars"><a href="#rs-vars" id="rs-vars-div-show"
                          onclick="showHide('rs-vars-div');return false;">+</a> 
        Variables for repetition in the rthm-seqs</h3>
      <div id="rs-vars-div" class="more">
        <p>The rhythms used in the <code>rhtm-seq</code> objects to create each
          voice of each module are highly repetitive. In order to make the
          rather long <code>rthm-seq-palette</code> both more efficient and
          more intelligible, a series of variables are created that not only
          store the more frequent rhythm combinations but also give them more
          recognizable names based on their function. In a few cases, the same
          rhythm combinations are given more than one variable name, as they
          serve more than one voice-leading function within the tonal modules
          that follow. </p>

        <p>The time signature (<code>ts</code>) and ten "bare" (i.e., without a
          function ascribed to them) rhythms are defined (<code>r-0</code>
          to <code>r-9</code>). These are then turned into longer sequences
          using Lisp's backquote and at-comma syntax for list splicing. </p>

        <p>The terms "cantus", "altus", "tenor", and "bassus" are used to
          indicate the four voices, and the terms "cantizans", "altizans",
          "tenorizans", and "bassizans" are used to denote specific
          voice-leading structures.</p>

        <pre class="source">
       ;; time signature
       (ts '((4 4)))
       ;; basic rest rhythm
       (r-0 '((w)))
       ;; various multi-bar rest sequences
       (2-bars-rest-ts `((,@ts ,@r-0) ,r-0))
       (5-bars-rest-ts `((,@ts ,@r-0) ,r-0 ,r-0 ,r-0 ,r-0))
       ;; first three bare (functionless) rhythm sequences
       (r-1 '(q h q))
       (r-2 '(+q q h))
       (r-3 '(h h))
       ;; BASIC FAUXBOURDON RHYTHM SEQ
       ;; assigning functions (as variable names) to bare rhythm sequences
       (5-6-sus-7-6 `(,@r-1))
       (tie-to-cantizans `(,@r-2))
       ;; creating variables for fauxbourdon voices
       (sus-7-6-to-half-cadence-cntzns-ts `((,@ts ,@5-6-sus-7-6)
                                            ,tie-to-cantizans)) 
       (four-halves-to-half-cadence-altzns-tnzns-ts `((,@ts ,@r-3) ,r-3))
       ;; fourth and fifth bare rhythms
       (r-4 '(w))
       (r-5 '(- e e - q h))
       ;; BASIC 2-BAR RUGGIERO RHYTHM SEQ
       ;; assigning functions (as variable names) to bare rhythm sequences
       (cantizans-interruptus `(,@r-1))
       (whole `(,@r-4))
       ;; creating variables for 2-bar ruggiero voices
       (2-bar-cadence-cantizans-ts `((,@ts ,@cantizans-interruptus) ,whole))
       (2-bar-cadence-tenorizans-ts `((,@ts ,@r-5) ,whole))
       (2-bar-cadence-bassizans-ts `((,@ts ,@whole) ,whole))
       ;; sixth bare rhythm
       (r-6 '(q q h))
       ;; assigning functions (as variable names) to bare rhythm sequences       
       (tenorizans-interruptus-1 `(,@r-2))
       (tenorizans-interruptus-2 `(,@r-6))
       ;; BASIC 5-BAR FALLING-5THS RUGGIERO SEQUENCE
       ;; creating variables for 5-bar falling-5ths ruggiero voices
       (5-bars-falling-fifths-cntzns-tnzs-ts 
        `((,@ts ,@cantizans-interruptus) ,tenorizans-interruptus-1
          ,cantizans-interruptus ,tenorizans-interruptus-1 ,whole))
       (5-bars-falling-fifths-tnzs-cntzns-ts 
        `((,@ts ,@tenorizans-interruptus-2) ,cantizans-interruptus
          ,tenorizans-interruptus-1 ,cantizans-interruptus ,whole))
       (5-bars-falling-fifths-bsszns-ts 
        `((,@ts ,@whole) ,whole ,whole ,whole ,whole))
       ;; seventh bare rhythm
       (r-7 '(h. q))
       ;; 3-BAR RUGGIERO IV-I-V-I MODULATION SEQUENCE
       ;; creating variables for 3-bar ruggiero IV-I-V-I modulation voices 
       (two-halves `(,@r-3))
       ;; eighth and ninth bare rhythms
       (r-8 '(q q q q))
       (r-9 '(q q q. e))
       ;; NEIGHBOR ELABORATIONS FOR RUGGIERO VOICES
       ;; creating elaborated upper-/lower-neighbor 2-bar bassizans
       (2-bar-upper-lower-neighbor-octave-bassizans-ts `((,@ts ,@r-8) ,whole))
       ;; creating elaborated lower-neighbor 2-bar altizans and tenorizans
       (2-bar-lower-neighbor-altizans-ts `((,@ts ,@r-9) ,whole))
       (2-bar-lower-neighbor-tenorizans-ts `((,@ts ,@r-6) ,whole))
       ;; BASIC 2-BAR SEKUND-AKKORD SEQUENCE
       ;; creating variable for basic sekund-akkord sequence
       (sekund-core `((,@ts ,@r-3) ,whole))
       ;; BASIC 2-BAR PEDAL-POINT SEQUENCE
       ;; creating variables for the inner and outer voices of the basic 2-bar
       ;; pedal-point sequence
       (2-bar-pedal-sustained-outer-voices-ts `((,@ts ,@whole) ,whole))
       (2-bar-pedal-moving-inner-halves-ts `((,@ts ,@r-3) ,whole))</pre>

        <p class="close"><a href="#rs-vars" id="rs-vars-div-hide"
              class="hideLink" onclick="showHide('rs-vars-div');return
              false;">close</a></p>
      </div>

      <h3 id="call"><a href="#call" id="call-div-show"
                       onclick="showHide('call-div');return false;">+</a>
        The call to make-slippery-chicken</h3>
      <div id="call-div" class="more">
      <p>The call to <code>make-slippery-chicken</code> is then also made
        within the <code>let*</code> enclosure, and its resulting object is
        stored in the variable <code>tonal-example</code>. </p>

      <p>The majority of the keyword arguments within the function are set by
        using the variables defined above. Only
        the <code>rthm-seq-palette</code> is defined within the function
        itself.</p>

      <pre class="source">
       (tonal-example
        (make-slippery-chicken
         '+tonal-example+
         :title "tonal example"
         :tempo-map '((1 (q 112)))
         :ensemble '(((vo (violin :midi-channel 1))
                      (vt (violin :midi-channel 2))
                      (va (viola :midi-channel 3))
                      (vc (cello :midi-channel 4))))
         :set-palette sp
         :set-map `((1 ,sm))
         :set-limits-low (first transposed-lims-lo-hi)
         :set-limits-high (second transposed-lims-lo-hi)
         :avoid-melodic-octaves nil
         :avoid-used-notes nil
         [...]
         :rthm-seq-map `((1 ,rsm))))</pre>

        <p class="close"><a href="#call" id="call-div-hide" class="hideLink"
              onclick="showHide('call-div');return false;">close</a></p>
      </div>

      <h3 id="rsp"><a href="#rsp" id="rsp-div-show"
                      onclick="showHide('rsp-div');return false;">+</a>
        The individual voices in the rthm-seq-palette</h3>
      <div id="rsp-div" class="more">
        <p>Each <code>rthm-seq</code> in the <code>rthm-seq-palette</code>
          then consists of one voice of one of the tonal 3- and 4-voiced
          modules. They are grouped together according to similar types
          (<em>fauxbourdon, ruggiero</em> etc.)</p>

        <h4>How the IDs are created</h4>
        <p>The IDs of these <code>rthm-seqs</code> are selected based on the
          module type, the variation number, the mode, and the voice. In this
          case, as above, the top voice is abbreviated "c" for <em>cantus</em>;
          and the remaining voices are abbreviated "a", "t", and "b" for
          "altus", "tenor", and "bassus". These IDs are used in
          the <code>combos-al</code> variable defined above when automatically
          generating the <code>rthm-seq-map</code></p>

        <h4>Splicing in the variables for longer rhythm patterns</h4>
        <p>The majority of the <code>rthm-seq</code> objects defined here make
          use of the variables declared above for the multi-bar combinations
          of repeating rhythm patterns. They are spliced into the definition
          of the <code>rthm-seq</code> objects using Lisp's backquote and
          comma syntax.</p>

        <pre class="source">
           (fx-1-maj-c (,sus-7-6-to-half-cadence-cntzns-ts</pre>

        <h4>Implementing the pitches-to-pseq function</h4>
        <p>The <code>rthm-seq</code> objects defined in this piece each have
          only one <code>pitch-seq</code> in
          their <code>pitch-seq-palette</code>. This one <code>pitch-seq</code>
          always applies to one of the two <code>core-set-</code> variables,
          which are both the C/0 transpositions of the given sets. By
          populating the <code>set-palette</code> with exact copies of the
          original two sets, which are merely transposed, the interval
          structure of each set will always remain the same, and
          the <code>pitch-seq</code> numbers will always return the pitch on
          the same scale degree in the transposed set. </p>

        <p>The <code>pitch-seq</code> numbers are generated automatically
          using the <code>pitches-to-pseq</code> function defined
          above. Each <code>:pitch-seq-palette</code> is created by splicing
          the results of calling that function with specified note-name
          symbols (as they would apply to the C/0 transposition of the module)
          and the core-set variable to which they apply into
          the <code>pitch-seq-palette</code>, again using Lisp's backquote and
          comma syntax.</p>

        <pre class="source">
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(g4 a4 g4 fs4 g4) core-set-maj))))</pre>

        <p>The <code>rthm-seq-palette</code> in full:</p>
        
        <pre class="source">
         :rthm-seq-palette 
         ;; The rthm-seqs: "-c" means cantus, "-a" means alto, "-t" means
         ;; tenor, "-b" means bass.
         `((2-rest (,2-bars-rest-ts))
           (5-rest (,5-bars-rest-ts))
           ;; FAUXBOURDON SEQUENCES
           ;; fauxbourdon 1 major
           (fx-1-maj-c (,sus-7-6-to-half-cadence-cntzns-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(g4 a4 g4 fs4 g4) core-set-maj))))
           (fx-1-maj-a (,four-halves-to-half-cadence-altzns-tnzns-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(e4 d4 c4 b3) core-set-maj))))
           (fx-1-maj-t (,four-halves-to-half-cadence-altzns-tnzns-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(c4 b3 a3 g3) core-set-maj))))
           ;; fauxbourdon 1 minor
           (fx-1-min-c (,sus-7-6-to-half-cadence-cntzns-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(g4 af4 g4 fs4 g4) core-set-min))))
           (fx-1-min-a (,four-halves-to-half-cadence-altzns-tnzns-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(ef4 d4 c4 b3) core-set-min))))
           (fx-1-min-t (,four-halves-to-half-cadence-altzns-tnzns-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(c4 bf3 af3 g3) core-set-min))))
           ;; fauxbourdon 2 major
           (fx-2-maj-t (,four-halves-to-half-cadence-altzns-tnzns-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(c3 b2 a2 g2) core-set-maj))))
           ;; fauxbourdon 2 minor
           (fx-2-min-t (,four-halves-to-half-cadence-altzns-tnzns-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(c3 bf2 af2 g2) core-set-min))))
           ;; fauxbourdon 3 major
           (fx-3-maj-c (,four-halves-to-half-cadence-altzns-tnzns-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(e5 d5 c5 b4) core-set-maj))))
           ;; RUGGIERO SEQUENCES
           ;; ruggiero 1 major
           (rg-1-maj-c (,2-bar-cadence-cantizans-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(b4 c5 b4 c5) core-set-maj))))
           (rg-1-maj-a (,2-bar-cadence-tenorizans-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(g4 f4 e4 d4 c4) core-set-maj))))
           (rg-1-maj-t (,2-bar-cadence-bassizans-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(g3 c3) core-set-maj))))
           ;; ruggiero 1 minor
           (rg-1-min-c (,2-bar-cadence-cantizans-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(b4 c5 b4 c5) core-set-min))))
           (rg-1-min-a (,2-bar-cadence-tenorizans-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(g4 f4 ef4 d4 c4) core-set-min))))
           (rg-1-min-t (,2-bar-cadence-bassizans-ts
                        :pitch-seq-palette 
                        (,(pitches-to-pseq '(g3 c3) core-set-min))))
           ;; ruggiero 2 major
           (rg-2-maj-c (,5-bars-falling-fifths-cntzns-tnzs-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(b4 c5 bf4 a4 g4 a4 bf4 af4 g4 f4
                                             ef4) core-set-maj))))
           (rg-2-maj-a (,5-bars-falling-fifths-tnzs-cntzns-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(f4 e4 d4 e4 f4 ef4 d4 c4 d4 ef4 d4
                                             ef4) core-set-maj))))
           (rg-2-maj-t (,5-bars-falling-fifths-bsszns-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g3 c3 f3 bf2 ef3) core-set-maj))))
           ;; ruggiero 2 minor
           (rg-2-min-c (,5-bars-falling-fifths-cntzns-tnzs-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(b4 c5 bf4 a4 g4 a4 bf4 af4 gf4 f4
                                             ef4) core-set-maj)))) 
           (rg-2-min-a (,5-bars-falling-fifths-tnzs-cntzns-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(f4 e4 d4 e4 f4 ef4 d4 c4 d4 ef4
                                             d4 ef4) core-set-maj))))
           (rg-2-min-t (,5-bars-falling-fifths-bsszns-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g3 c3 f3 bf2 ef3) core-set-maj))))
           ;; ruggiero 3 major
           (rg-3-maj-c (((,@ts ,@cantizans-interruptus) ,whole
                         ,tie-to-cantizans) 
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(b4 c5 bf4 a4 gs4 a4)
                                           core-set-maj))))
           (rg-3-maj-a (((,@ts ,@r-6) ,tenorizans-interruptus-1 ,two-halves)
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g4 g4 g4 f4 e4 e4 e4)
                                           core-set-maj))))
           (rg-3-maj-t (((,@ts ,@r-6) ,r-7 ,two-halves)
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(d4 e4 d4 d4 c4 b3 cs4)
                                           core-set-maj))))
           (rg-3-maj-b (((,@ts ,@whole) ,two-halves ,two-halves)
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g3 d3 a3 e3 a2) core-set-maj))))
           ;; ruggiero 4 minor
           (rg-4-min-c (,2-bar-cadence-cantizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(b4 c5 b4 c5) core-set-min))))
           (rg-4-min-a (,2-bar-cadence-tenorizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g4 f4 ef4 d4 c4) core-set-min))))
           (rg-4-min-b (,2-bar-upper-lower-neighbor-octave-bassizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g3 fs3 g3 g2 c3) core-set-min))))
           ;; ruggiero 5 minor
           (rg-5-min-c (,2-bar-cadence-cantizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(b4 c5 b4 c5) core-set-min))))
           (rg-5-min-a (,2-bar-lower-neighbor-altizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g4 fs4 g4 f4 e4) core-set-min))))
           (rg-5-min-t (,2-bar-lower-neighbor-tenorizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(d4 c4 d4 c4) core-set-min))))
           (rg-5-min-b (,2-bar-upper-lower-neighbor-octave-bassizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g3 af3 g3 g2 c3) core-set-min))))
           ;; ruggiero 6 major
           (rg-6-maj-c (,2-bar-cadence-tenorizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g5 f5 e5 d5 c5) core-set-maj))))
           (rg-6-maj-a (,2-bar-cadence-cantizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(b4 c5 b4 c5) core-set-maj))))
           (rg-6-maj-b (,2-bar-cadence-bassizans-ts
                        :pitch-seq-palette
                        (,(pitches-to-pseq '(g3 c3) core-set-maj))))
           ;; SEKUND SEQUENCES
           ;; sekund 1 major
           (sek-1-maj-c (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(e5 e5 f5) core-set-maj))))
           (sek-1-maj-a (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(c5 c5 c5) core-set-maj))))
           (sek-1-maj-t (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(g4 g4 f4) core-set-maj))))
           (sek-1-maj-b (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(c3 bf2 a2) core-set-maj))))
           ;; sekund 1 major
           (sek-2-maj-c (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(e5 fs5 g5) core-set-maj))))
           (sek-2-maj-a (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(c4 d5 d5) core-set-maj))))
           (sek-2-maj-t (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(g4 a4 g4) core-set-maj))))
           (sek-2-maj-b (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(c3 c3 b2) core-set-maj))))
           ;; sekund 3 minor
           (sek-3-min-c (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(ef5 e5 f5) core-set-min))))
           (sek-3-min-a (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(c5 c5 c5) core-set-min))))
           (sek-3-min-t (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(g4 g4 f4) core-set-min))))
           (sek-3-min-b (,sekund-core
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(c3 bf2 af2) core-set-min))))
           ;; PEDAL SEQUENCES
           ;; pedal 1 major
           (ped-1-maj-c (,2-bar-pedal-sustained-outer-voices-ts
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(c5 c5) core-set-maj))))
           (ped-1-maj-a (,2-bar-pedal-moving-inner-halves-ts
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(g4 a4 g4) core-set-maj))))
           (ped-1-maj-t (,2-bar-pedal-moving-inner-halves-ts
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(e4 f4 e4) core-set-maj))))
           (ped-1-maj-b (,2-bar-pedal-sustained-outer-voices-ts
                         :pitch-seq-palette
                         (,(pitches-to-pseq '(c3 c3) core-set-maj)))))</pre>
                

        <p class="close"><a href="#rsp" id="rsp-div-hide" class="hideLink"
              onclick="showHide('rsp-div');return false;">close</a></p>
      </div>

      <h3 id="enharmonics"><a href="#enharmonics" id="enharmonics-div-show"
                      onclick="showHide('enharmonics-div');return false;">+</a>
        Enharmonic spellings that reflect the tonality</h3>
      <div id="enharmonics-div" class="more">
        <p>By default, <em>slippery chicken</em> will automatically attempt to
          respell all of the pitches in the resulting score in a manner that
          makes sense in an atonal setting. The result of that automatic
          procedure in this example results in a number of pitches needing to
          be enharmonically flipped, in order to accurately reflect their
          function within a tonal setting.</p>

        <p>There are three options for changing the enharmonic pitches of one
          or more notes in a <code>slippery-chicken</code> object:
          the <a href="../robodoc/slippery-chicken-edit_lsp.html#slippery2dchicken2dedit2frespell2dnotes"><code>respell-notes</code></a>,
          <a href="../robodoc/rthm-seq-bar_lsp.html#rthm2dseq2dbar2fenharmonic"><code>enharmonic</code></a>,
          and
          <a href="../robodoc/slippery-chicken-edit_lsp.html#slippery2dchicken2dedit2fenharmonics"><code>enharmonics</code></a>
          methods. This example uses the latter two methods. </p>

        <p>In order for these three methods to be effective, they must be
          called as post-generation editing methods prior to the calls to any
          of the printable output methods, and therefore require that
          the <code>respell-notes</code> option of <code>cmn-display</code>
          and <code>write-lp-data-for-all</code> be set
          to <code>NIL</code>.</p> 
        
        <pre class="source">
  (cmn-display tonal-example :file "/tmp/tonal.eps" 
               :auto-bar-nums 5
               :respell-notes nil
               :auto-clefs nil)
  (write-lp-data-for-all tonal-example
                         :respell-notes nil
                         :auto-clefs nil))</pre>

        <h4>enharmonics</h4>
        <p>The <code>enharmonics</code> method allows the user to specify
          a range of measures in which pitches are to be enharmonically
          flipped, as well as a list of note-name symbols that are to be
          affected. The code for this piece therefore uses a loop in which the
          starting and ending bars, the player, and the list of pitches, are
          passed as a <code>for</code> value to the macro, and
          a <code>do</code> statement that applies
          the <code>enharmonics</code> method with these different values at
          each iteration. This method does not allow for the enharmonic
          spelling of "white-key" notes (e.g. C as B-sharp etc.)</p>

        <pre class="source">
  (loop for d in '((14 16 vo (cs5)) (15 16 vt (fs4)) (19 27 vt (af4))
                   (25 25 va (af4)) (27 28 vo (cs5)) (27 30 vt (fs4 cs5)) 
                   (27 30 va (fs4)) (42 45 vo (cs5)) (43 44 vt (fs4))
                   (47 59 vo (bf5 af5)) (47 59 vt (ef5 af5)) 
                   (47 59 va (bf4 ef5)) (61 65 vo (ef5)) (61 66 vt (bf4 af4))
                   (70 70 vo (af5)))
     do 
       (enharmonics tonal-example (first d) (second d) (third d) 
                    :pitches (fourth d)))</pre>

        <h4>enharmonic</h4>
        <p>The <code>enharmonic</code> method always applies to only one
          sounding event object at a time. The
          optional <code>:force-naturals</code> argument of this method allows
          the method to be used to respell "white-key" pitches as enharmonic
          equivalents. The method is used here as well within a loop
          whose <code>for</code> statement specifies a list of sublists
          consisting of the measure number, event number and player ID of the
          notes to be altered.</p>

        <pre class="source">
  (loop for en in '((17 1 vt) (17 3 vo) (17 3 vt) (20 2 vo) (20 2 vt) (21 1 vo)
                    (21 3 vo) (21 2 vc) (24 2 vo) (24 2 vt) (25 1 vo) (25 3 vo)
                    (25 2 vt) (26 1 vt) (27 2 vt) (28 2 va) (29 2 vo) (29 3 vo)
                    (29 1 vc) (30 2 vt) (45 2 vo) (45 3 vo) (45 1 vt) (45 3 vt)
                    (47 2 vo) (48 1 vc) (49 1 vt) (49 3 vt) (52 1 vc) (53 1 vt)
                    (53 3 vt) (57 2 vo) (58 1 vc) (59 1 vt) (59 3 vt) (62 2 vo)
                    (63 1 vo) (62 2 vt) (61 2 va) (62 1 va))
     do (enharmonic (get-event tonal-example (first en) (second en) (third en))
                    :force-naturals t))</pre>

        <p class="close"><a href="#enharmonics" id="enharmonics-div-hide"
              class="hideLink" onclick="showHide('enharmonics-div');return
              false;">close</a></p>
      </div>

      <h3 id="keys"><a href="#keys" id="keys-div-show"
                      onclick="showHide('keys-div');return false;">+</a>
        Inserting key changes and double-bars</h3>
      <div id="keys-div" class="more">
        <p>Another small loop is used to insert key changes and double-bar
          lines into the printable output. It is important to point out here
          that CMN always prints the accidentals into the score, even if a key
          signature has been added; whereas, LilyPond will hide accidentals
          already present in a key signature and automatically add cautionary
          accidentals where suited. </p>

        <p>This little loop takes care of both the key signature and the
          double-bar placement at the same time.</p>

        <pre class="source">
  (loop for b-k in '((12 (ef major)) (19 (fs minor)) (27 (gf major))
                     (32 (ef major)) (47 (fs major)) (68 (a minor)))
     do
       (loop for p in '(vo vt va vc)
          do
            (change-bar-line-type tonal-example (1- (first b-k)) 1)
            (add-mark-before 
             (get-event tonal-example (first b-k) 1 p)
             `(key ,@(second b-k)))))</pre>

        <!-- MDE Tue Oct 16 18:08:15 2012 -- if you make me the ticket I'll do
             this asap -->
        <!-- 
        <p class="nb">NB: At the time of writing, the process used
            by <em>slippery chicken</em> to automatically generate
            the <tt>.ly</tt> files resulted in an extra double-bar line being
            erroneously added to the viola data. This is currently being
            addressed. The LilyPond-generated PDF file associated with this
            tutorial was created after altering bars 18 and 19 of
            the <tt>-va.ly</tt> file by hand. </p> -->

        <p class="close"><a href="#keys" id="keys-div-hide" class="hideLink"
              onclick="showHide('keys-div');return false;">close</a></p>
      </div>

      <h3 id="staff-names"><a href="#staff-names" id="staff-names-div-show"
                      onclick="showHide('staff-names-div');return false;">+</a>
        Changing staff names for same instruments</h3>
      <div id="staff-names-div" class="more">
        <p>The final step undertaken by the code for this piece is to change
          the instrument staff names of the two violin parts for the printable
          output. By default these will both be identified in the score
          as <em>violin</em>. The following little loop uses <code>setf</code>
          to change the value of the <code>staff-name</code>
          and <code>staff-short-name</code> slots of the corresponding
          instrument objects stored in this <code>slippery-chicken</code>
          object's <code>ensemble</code> slot to <em>violin 1</em>
          and <em>violin 2</em>.</p>

        <pre class="source">
  (loop for n in '((vo "violin 1" "vln 1") (vt "violin 2" "vln 2"))
     do 
       (setf (staff-name 
              (get-data-data (first n) (ensemble tonal-example))) 
             (second n))
       (setf (staff-short-name 
              (get-data-data (first n) (ensemble tonal-example)))
             (third n)))</pre>

        <p class="close"><a href="#staff-names" id="staff-names-div-hide"
              class="hideLink" onclick="showHide('staff-names-div');return
              false;">close</a></p>
      </div>

      <h3 id="output"><a href="#output" id="output-div-show"
                         onclick="showHide('output-div');return false;">+</a>
        Output</h3>
      <div id="output-div" class="more">
        <p>The output for this piece is generated in the same way already
          covered in other tutorials. Of note here is the use of
          the <code>auto-bar-nums</code> argument to
          the <code>cmn-display</code> method, which causes bar numbers to be
          placed into the score at intervals of 5 measures, and the setting of
          both the <code>respell-notes</code> and <code>auto-clefs</code>
          options to <code>NIL</code> in both the <code>cmn-display</code>
          and <code>write-lp-data-for-all</code> methods. The former is
          necessary in order for the enharmonic changes described above to be
          effective. The latter is merely a matter of preference. </p>

        <p class="close"><a href="#output" id="output-div-hide" class="hideLink"
              onclick="showHide('output-div');return false;">close</a></p>
      </div>

      <!-- **************************************************************** -->
      <!-- This spacer <br> is necessary as a buffer between the content and the
           footer. It cannot be added as padding to #push, since #push has to be
           the same size as #footer in order for the dynamic placement to work
           properly --> <br /><br />
      <div id="push"></div>
    </div>
    <script type="text/javascript">footer();</script>
    <noscript>Your browser does not support JavaScript!</noscript>
  </body>
</html>
